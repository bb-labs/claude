!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){(function(t){var s=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},s=0;s<e.length;s++)i[e[s]]=Object.getOwnPropertyDescriptor(t,e[s]);return i},r=/%[sdj%]/g;e.format=function(t){if(!b(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(a(arguments[i]));return e.join(" ")}i=1;for(var s=arguments,n=s.length,o=String(t).replace(r,function(t){if("%%"===t)return"%";if(i>=n)return t;switch(t){case"%s":return String(s[i++]);case"%d":return Number(s[i++]);case"%j":try{return JSON.stringify(s[i++])}catch(t){return"[Circular]"}default:return t}}),c=s[i];i<n;c=s[++i])f(c)||!v(c)?o+=" "+c:o+=" "+a(c);return o},e.deprecate=function(i,s){if(void 0!==t&&!0===t.noDeprecation)return i;if(void 0===t)return function(){return e.deprecate(i,s).apply(this,arguments)};var r=!1;return function(){if(!r){if(t.throwDeprecation)throw new Error(s);t.traceDeprecation?console.trace(s):console.error(s),r=!0}return i.apply(this,arguments)}};var n,o={};function a(t,i){var s={seen:[],stylize:h};return arguments.length>=3&&(s.depth=arguments[2]),arguments.length>=4&&(s.colors=arguments[3]),y(i)?s.showHidden=i:i&&e._extend(s,i),g(s.showHidden)&&(s.showHidden=!1),g(s.depth)&&(s.depth=2),g(s.colors)&&(s.colors=!1),g(s.customInspect)&&(s.customInspect=!0),s.colors&&(s.stylize=c),l(s,t,s.depth)}function c(t,e){var i=a.styles[e];return i?"["+a.colors[i][0]+"m"+t+"["+a.colors[i][1]+"m":t}function h(t,e){return t}function l(t,i,s){if(t.customInspect&&i&&I(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(s,t);return b(r)||(r=l(t,r,s)),r}var n=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(b(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(m(e))return t.stylize(""+e,"number");if(y(e))return t.stylize(""+e,"boolean");if(f(e))return t.stylize("null","null")}(t,i);if(n)return n;var o=Object.keys(i),a=function(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(i)),x(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return u(i);if(0===o.length){if(I(i)){var c=i.name?": "+i.name:"";return t.stylize("[Function"+c+"]","special")}if(w(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(A(i))return t.stylize(Date.prototype.toString.call(i),"date");if(x(i))return u(i)}var h,v="",T=!1,R=["{","}"];(d(i)&&(T=!0,R=["[","]"]),I(i))&&(v=" [Function"+(i.name?": "+i.name:"")+"]");return w(i)&&(v=" "+RegExp.prototype.toString.call(i)),A(i)&&(v=" "+Date.prototype.toUTCString.call(i)),x(i)&&(v=" "+u(i)),0!==o.length||T&&0!=i.length?s<0?w(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),h=T?function(t,e,i,s,r){for(var n=[],o=0,a=e.length;o<a;++o)E(e,String(o))?n.push(p(t,e,i,s,String(o),!0)):n.push("");return r.forEach(function(r){r.match(/^\d+$/)||n.push(p(t,e,i,s,r,!0))}),n}(t,i,s,a,o):o.map(function(e){return p(t,i,s,a,e,T)}),t.seen.pop(),function(t,e,i){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(h,v,R)):R[0]+v+R[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,i,s,r,n){var o,a,c;if((c=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),E(s,r)||(o="["+r+"]"),a||(t.seen.indexOf(c.value)<0?(a=f(i)?l(t,c.value,null):l(t,c.value,i-1)).indexOf("\n")>-1&&(a=n?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),g(o)){if(n&&r.match(/^\d+$/))return a;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function d(t){return Array.isArray(t)}function y(t){return"boolean"==typeof t}function f(t){return null===t}function m(t){return"number"==typeof t}function b(t){return"string"==typeof t}function g(t){return void 0===t}function w(t){return v(t)&&"[object RegExp]"===T(t)}function v(t){return"object"==typeof t&&null!==t}function A(t){return v(t)&&"[object Date]"===T(t)}function x(t){return v(t)&&("[object Error]"===T(t)||t instanceof Error)}function I(t){return"function"==typeof t}function T(t){return Object.prototype.toString.call(t)}function R(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(i){if(g(n)&&(n=t.env.NODE_DEBUG||""),i=i.toUpperCase(),!o[i])if(new RegExp("\\b"+i+"\\b","i").test(n)){var s=t.pid;o[i]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",i,s,t)}}else o[i]=function(){};return o[i]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=y,e.isNull=f,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=b,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=w,e.isObject=v,e.isDate=A,e.isError=x,e.isFunction=I,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i(2);var z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(){var t=new Date,e=[R(t.getHours()),R(t.getMinutes()),R(t.getSeconds())].join(":");return[t.getDate(),z[t.getMonth()],e].join(" ")}function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",O(),e.format.apply(e,arguments))},e.inherits=i(3),e._extend=function(t,e){if(!e||!v(e))return t;for(var i=Object.keys(e),s=i.length;s--;)t[i[s]]=e[i[s]];return t};var N="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function S(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(N&&t[N]){var e;if("function"!=typeof(e=t[N]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,N,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,s=new Promise(function(t,s){e=t,i=s}),r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);r.push(function(t,s){t?i(t):e(s)});try{t.apply(this,r)}catch(t){i(t)}return s}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),N&&Object.defineProperty(e,N,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,s(t))},e.promisify.custom=N,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function i(){for(var i=[],s=0;s<arguments.length;s++)i.push(arguments[s]);var r=i.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var n=this,o=function(){return r.apply(n,arguments)};e.apply(this,i).then(function(e){t.nextTick(o,null,e)},function(e){t.nextTick(S,e,o)})}return Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.defineProperties(i,s(e)),i}}).call(this,i(1))},function(t,e){var i,s,r=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(t){i=n}try{s="function"==typeof clearTimeout?clearTimeout:o}catch(t){s=o}}();var c,h=[],l=!1,u=-1;function p(){l&&c&&(l=!1,c.length?h=c.concat(h):u=-1,h.length&&d())}function d(){if(!l){var t=a(p);l=!0;for(var e=h.length;e;){for(c=h,h=[];++u<e;)c&&c[u].run();u=-1,e=h.length}c=null,l=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===o||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function f(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new y(t,e)),1!==h.length||l||a(d)},y.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},function(t,e,i){"use strict";i.r(e);var s={};i.r(s),i.d(s,"add",function(){return R}),i.d(s,"assign",function(){return z}),i.d(s,"divide",function(){return O}),i.d(s,"multiply",function(){return E}),i.d(s,"subtract",function(){return N});var r={};i.r(r),i.d(r,"cross",function(){return S}),i.d(r,"inverse",function(){return P}),i.d(r,"matMult",function(){return C}),i.d(r,"adjugate",function(){return F}),i.d(r,"determinant",function(){return M});var n={};i.r(n),i.d(n,"cos",function(){return j}),i.d(n,"exp",function(){return U}),i.d(n,"max",function(){return $}),i.d(n,"mean",function(){return L}),i.d(n,"norm",function(){return k}),i.d(n,"sin",function(){return D}),i.d(n,"sum",function(){return V}),i.d(n,"min",function(){return Y}),i.d(n,"negate",function(){return G});const o=/ +/g,a=/\d+/,c=":",h=/\d*:\d*/,l="],\n$1[",u=/\]\,(\s*)\[/g,p=/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g,d={0:"",1:"i",2:"j",3:"k"},y={"":0,i:1,I:1,j:2,J:2,k:3,K:3},f=Object.assign(Math,{add:function(t,e){return t+e},subtract:function(t,e){return t-e},divide:function(t,e){return t/e},multiply:function(t,e){return t*e}});class m{constructor({size:t,typed:e}){this.size=t,this.typed=e}static promote(t,e){if(!e)return[t,e];const i=t.type.size>e.type.size?t.type:e.type;return[t.astype({type:i}),e.astype({type:i})]}static isTypedArray(t){return void 0!==t&&(t.constructor===Int8Array||t.constructor===Int16Array||t.constructor===Int32Array||t.constructor===Uint8Array||t.constructor===Uint16Array||t.constructor===Uint32Array||t.constructor===Float32Array||t.constructor===Float64Array||t.constructor===Uint8ClampedArray)}static resolve(t){const e=m.parse(t);return 1===e.length?m.Float32:2===e.length?m.ComplexFloat32:e.length>2?m.QuatFloat32:void 0}static parse(t){let e,i=1;const s=[],r=String(t).match(p).filter(function(t){return!o.test(t)});for(let t=0;t<r.length;t++)if((e=r[t])in y)isNaN(r[t-1])&&(s[y[e]]=s[y[e]]||0,s[y[e]]+=i);else if("+"===e)i=1;else if("-"===e)i=-1;else if(!isNaN(e)){let n=r[t+1];n in y?(s[y[n]]=s[y[n]]||0,s[y[n]]+=i*Number(e)):(s[0]=s[0]||0,s[0]+=i*Number(e))}return s}array(t){return m.isTypedArray(t)?t:t.constructor===Array?new this.typed(t.flatMap(function(t){return this.align(m.parse(t))},this)):t.constructor===Number?new this.typed(t*this.size):void 0}align(t){return t.length=this.size,Array.from(t,function(t){return t||0})}}m.Int8=new m({size:1,typed:Int8Array}),m.Int16=new m({size:1,typed:Int16Array}),m.Int32=new m({size:1,typed:Int32Array}),m.Uint8=new m({size:1,typed:Uint8Array}),m.Uint16=new m({size:1,typed:Uint16Array}),m.Uint32=new m({size:1,typed:Uint32Array}),m.Float32=new m({size:1,typed:Float32Array}),m.Float64=new m({size:1,typed:Float64Array}),m.Uint8Clamped=new m({size:1,typed:Uint8ClampedArray}),m.ComplexInt8=new m({size:2,typed:Int8Array}),m.ComplexInt16=new m({size:2,typed:Int16Array}),m.ComplexInt32=new m({size:2,typed:Int32Array}),m.ComplexUint8=new m({size:2,typed:Uint8Array}),m.ComplexUint16=new m({size:2,typed:Uint16Array}),m.ComplexUint32=new m({size:2,typed:Uint32Array}),m.ComplexFloat32=new m({size:2,typed:Float32Array}),m.ComplexFloat64=new m({size:2,typed:Float64Array}),m.ComplexUint8Clamped=new m({size:2,typed:Uint8ClampedArray}),m.QuatInt8=new m({size:4,typed:Int8Array}),m.QuatInt16=new m({size:4,typed:Int16Array}),m.QuatInt32=new m({size:4,typed:Int32Array}),m.QuatUint8=new m({size:4,typed:Uint8Array}),m.QuatUint16=new m({size:4,typed:Uint16Array}),m.QuatUint32=new m({size:4,typed:Uint32Array}),m.QuatFloat32=new m({size:4,typed:Float32Array}),m.QuatFloat64=new m({size:4,typed:Float64Array}),m.QuatUint8Clamped=new m({size:4,typed:Uint8ClampedArray});var b=i(0);class g{constructor(t){this.type=void 0!==t.type?t.type:m.Float32,this.shape=void 0!==t.shape?t.shape:[],this.offset=void 0!==t.offset?t.offset:0,this.contig=void 0===t.contig||t.contig,this.strides=void 0!==t.strides?t.strides:g.strides(this.shape,this.type),this.id=`${this.type.size}|${this.shape}|${this.strides}|${this.offset}`,this.size=this.shape.reduce(f.multiply,1),this.lastStride=this.strides[this.strides.length-1]}static isContigous(t){let e=-1;for(let i=0;i<t.length;i++){if(e>=0&&t[i].constructor===String&&i-e>1)return!1;t[i].constructor===String&&(e=i)}return!0}static strides(t,e,i){const s=new Array(t.length);let r=i||e.size;s[s.length-1]=r;for(let e=t.length-1;e>0;e--)s[e-1]=r*=t[e];return s}static reshape(t,e){const i=new Array(t.length),s=t.reduce(f.multiply,1);for(let r=0;r<t.length;r++)i[r]=t[r]<0?-e/s:t[r];return i}copy(){return new g(JSON.parse(JSON.stringify(this)))}flatIndex(t){let e=this.offset;for(let i=0;i<t.length;i++)e+=t[i]*this.strides[i];return e}slice(t){const e=new Array,i=new Array,s=g.isContigous(t);let r=this.offset;for(let s=0;s<this.shape.length;s++)if(t[s]===c||void 0===t[s])e.push(this.shape[s]),i.push(this.strides[s]);else if(h.test(t[s])){let[n,o]=t[s].split(c).map(Number);0===o&&(o=this.shape[s]),r+=this.strides[s]*n,e.push(o-n),i.push(this.strides[s])}else a.test(t[s])&&(r+=this.strides[s]*t[s]);return new g({shape:e,strides:i,offset:r,contig:s,type:this.type})}transpose(){return new g({type:this.type,shape:this.shape.slice().reverse(),strides:this.strides.slice().reverse(),offset:this.offset,contig:!1})}reshape(t){const e=g.reshape(t,this.size),i=g.strides(e,this.type,this.lastStride);return new g({type:this.type,shape:e,strides:i})}}class w{constructor({header:t,data:e}){Object.assign(this,this.header=t),this.data=this.type.array(e||this.size)}static shape(t,e=[]){return t.constructor===w?t.shape:m.isTypedArray(t)?[t.length]:t.constructor!==Array?e:w.shape(t[0],e.concat(t.length))}static tensor({data:t,type:e}){if(void 0===t)return t;if(t.constructor===w)return t;const i=w.shape(t);return t.constructor!==String&&t.constructor!==Number&&t.constructor!==Array||(t=[t].flat(Number.POSITIVE_INFINITY)),e=e||m.resolve(t[0]),new w({data:t,header:new g({type:e,shape:i})})}static zerosLike({tensor:t}){return new w({header:new g({...t})})}static zeros({shape:t,type:e}){return new w({header:new g({shape:t,type:e})})}static onesLike({tensor:t}){return(t=new w({header:new g({...t})})).data.fill(1),t}static ones({shape:t,type:e}){const i=new w({header:new g({shape:t,type:e})});return i.data.fill(1),i}static arange({start:t=0,step:e=1,stop:i,type:s}){const r=new w({header:new g({type:s,shape:[f.round((i-t)/e)]})});for(let s=t,n=0;s<i;s+=e,n++)r.data[n]=s;return r}static linspace({start:t,stop:e,num:i=50,type:s}){const r=(e-t)/i,n=new w({header:new g({type:s,shape:[i]})});for(let i=t,s=0;i<e;i+=r,s+=n.type.size)n.data[s]=i;return n}static rand({shape:t,type:e}){const i=new w({header:new g({shape:t,type:e})});for(let t=0;t<i.data.length;t++)i.data[t]=f.random()-1;return i}static randrange({low:t,high:e,shape:i,type:s}){const r=new w({header:new g({shape:i,type:s})});for(let i=0;i<r.data.length;i++)r.data[i]=t+f.floor(f.random()*(e-t));return r}static eye({shape:t,type:e}){const i=new w({header:new g({shape:t,type:e})}),s=i.strides.reduce(f.add),r=f.min(...i.shape);for(let t=0;t<r*s;t+=s)i.data[t]=1;return i}astype({type:t}){if(t===this.type)return this;if(1===this.size)return this;const e=this.toRaw().flat(Number.POSITIVE_INFINITY),i=t.array(this.size);for(let s=0,r=0;s<e.length;s+=this.type.size,r+=t.size)for(let n=0;n<Math.min(t.size,this.type.size);n++)i[r+n]=e[s+n];return new w({header:new g({type:t,shape:this.shape}),data:i})}copy(){return new w({header:this.header,data:this.data.slice()})}ravel(){return w.tensor({data:this.toRaw(),type:this.type}).reshape({shape:[-1]})}slice({region:t}){return new w({header:this.header.slice(t),data:this.data})}T(){return new w({header:this.header.transpose(),data:this.data})}reshape({shape:t}){return this.contig?new w({header:this.header.reshape(t),data:this.data}):w.tensor({data:this.toRaw(),type:this.type}).reshape({shape:t})}toRaw(t=this.offset,e=0){return this.shape.length&&e!==this.shape.length?[...new Array(this.shape[e]).keys()].map(function(i){return this.toRaw(i*this.strides[e]+t,e+1)},this):this.toStringAtIndex(t)}valueOf(){return this.data[this.offset]}toStringAtIndex(t,e=""){for(let i=0;i<this.type.size;i++){const s=Math.sign(this.data[t+i])<0?"-":"+",r=Math.abs(this.data[t+i]);r&&(e+=`${s}${r.toPrecision()}${d[i]}`)}return e?e.startsWith("+")?e.slice(1):e:"0"}toString(){return JSON.stringify(this.toRaw()).replace(u,l)}[b.inspect.custom](){return this.toString()}}class v{static split(t=[],e=[]){return[t.slice(0,t.length/2),t.slice(t.length/2),e.slice(0,e.length/2),e.slice(e.length/2)]}static match(t,e){const i=Math.max(t.length,e.length);return t.length=i,e.length=i,[Array.from(t,function(t){return t||0}),Array.from(e,function(t){return t||0})]}static variable({symbol:t,size:e,index:i}){return new Array(e).fill(null).map(function(e,s){return`${t}[${i}+${s}]`})}static ONE(t){return new Array(t).fill(1)}static ZERO(t){return new Array(t).fill(0)}static POSITIVE_INFINITY(t){return Array(t).fill(Number.POSITIVE_INFINITY)}static NEGATIVE_INFINITY(t){return Array(t).fill(Number.NEGATIVE_INFINITY)}static if(t,e){return`if(${t}){\n            ${e}\n        }`}static noop(t,e){if([t,e]=v.match(t,e),1===t.length)return[`(${t})`];const[i,s,r,n]=v.split(t,e);return[v.noop(i,r),v.noop(s,n)].flat(Number.POSITIVE_INFINITY)}static exp(t){if(1===t.length)return[`Math.exp(${t})`];const[e,i]=v.split(t);return 2===t.length?v.scale([v.cos(i),v.sin(i)],v.exp(e)):[v.exp(e),v.exp(i)].flat(Number.POSITIVE_INFINITY)}static sin(t){if(1===t.length)return[`Math.sin(${t})`];const[e,i]=v.split(t);return[v.sin(e),v.sin(i)].flat(Number.POSITIVE_INFINITY)}static cos(t){if(1===t.length)return[`Math.cos(${t})`];const[e,i]=v.split(t);return[v.cos(e),v.cos(i)].flat(Number.POSITIVE_INFINITY)}static lessThan(t,e){if([t,e]=v.match(t,e),1===t.length)return[`(${t}<${e})`];const[i,s,r,n]=v.split(t,e);return[v.lessThan(i,r),v.lessThan(s,n)].flat(Number.POSITIVE_INFINITY)}static greaterThan(t,e){if([t,e]=v.match(t,e),1===t.length)return[`(${t}>${e})`];const[i,s,r,n]=v.split(t,e);return[v.greaterThan(i,r),v.greaterThan(s,n)].flat(Number.POSITIVE_INFINITY)}static add(t,e){if([t,e]=v.match(t,e),1===t.length)return[`(${t}+${e})`];const[i,s,r,n]=v.split(t,e);return[v.add(i,r),v.add(s,n)].flat(Number.POSITIVE_INFINITY)}static subtract(t,e){if([t,e]=v.match(t,e),1===t.length)return[`(${t}-${e})`];const[i,s,r,n]=v.split(t,e);return[v.subtract(i,r),v.subtract(s,n)].flat(Number.POSITIVE_INFINITY)}static multiply(t,e){if([t,e]=v.match(t,e),1===t.length)return[`${t}*${e}`];const[i,s,r,n]=v.split(t,e);return[v.subtract(v.multiply(i,r),v.multiply(v.conjugate(n),s)),v.add(v.multiply(n,i),v.multiply(s,v.conjugate(r)))].flat(Number.POSITIVE_INFINITY)}static divide(t,e,i){return[e,i]=v.match(e,i),1===e.length?[`${t}=(${e}/${i})`]:[`var mod = (1/${v.sum(v.square(i))})`,v.assign(t,v.scale(v.multiply(e,v.conjugate(i)),"mod"))].join("\n")}static squareRoot(t){if(1===t.length)return[`Math.sqrt(${t})`];const[e,i]=v.split(t);return[v.squareRoot(e),v.squareRoot(i)].flat(Number.POSITIVE_INFINITY)}static sum(t){if(1===t.length)return[`(${t})`];const[e,i]=v.split(t);return v.add(v.sum(e),v.sum(i))}static scale(t,e){if(1===t.length)return[`(${t}*${e})`];const[i,s]=v.split(t);return[v.scale(i,e),v.scale(s,e)].flat(Number.POSITIVE_INFINITY)}static square(t){if(1===t.length)return[`(${t}*${t})`];const[e,i]=v.split(t);return[v.square(e),v.square(i)].flat(Number.POSITIVE_INFINITY)}static conjugate(t){if(1===t.length)return[`(${t})`];const[e,i]=v.split(t);return[v.conjugate(e),v.negate(i)].flat(Number.POSITIVE_INFINITY)}static negate(t){if(1===t.length)return[`-(${t})`];const[e,i]=v.split(t);return[v.negate(e),v.negate(i)].flat(Number.POSITIVE_INFINITY)}static assign(t,e,i="="){if(1===t.length)return[`${t}${i}${e}`];const[s,r,n,o]=v.split(t,e);return[v.assign(s,n,i),v.assign(r,o,i)].flat(Number.POSITIVE_INFINITY)}}const A=function(t){return`for(let i${t}=0; i${t} < ${this.shape[t]}; i${t}++){`},x=function(t,e,i){return e.reduce(function(e,s,r){return`${e} + ${t}.strides[${i?s:r}] * i${s}`},`const ${t}Index = ${t}.offset`)},I=function(t,e){const i=this.shape.length-e-1;return!(i<0)&&this.shape[i]>1};class T{constructor(t,e,i,s){this.A=t,this.B=e,this.R=i,this.symbolic={},this.symbolic.totalLoopAxes=[...new Array(Math.max(t.shape.length,e.shape.length)).keys()],this.symbolic.totalLoops=this.symbolic.totalLoopAxes.map(A,i),this.symbolic.axes={},this.symbolic.axes.R=this.symbolic.totalLoopAxes,this.symbolic.axes.A=this.symbolic.totalLoopAxes.slice().reverse().filter(I,t).reverse(),this.symbolic.axes.B=this.symbolic.totalLoopAxes.slice().reverse().filter(I,e).reverse(),this.symbolic.indices={},this.symbolic.indices.R=x("R",this.symbolic.axes.R,!0),this.symbolic.indices.A=x("A",this.symbolic.axes.A,t.shape.length===i.shape.length),this.symbolic.indices.B=x("B",this.symbolic.axes.B,e.shape.length===i.shape.length),this.symbolic.variables={},this.symbolic.variables.A=v.variable({symbol:"A.data",index:"AIndex",size:t.type.size}),this.symbolic.variables.B=v.variable({symbol:"B.data",index:"BIndex",size:e.type.size}),this.symbolic.variables.R=v.variable({symbol:"R.data",index:"RIndex",size:i.type.size}),this.symbolic.operation=s.call(this),this.symbolic.source=this.symbolicSource(),this.symbolic.method=new Function("A,B,R",`${this.symbolic.source}; return R`),this.invoke=this.symbolic.method}static resultant(t,e){const i=f.max(t.shape.length,e.shape.length),s=[];for(let r=0;r<i;r++){const i=e.shape.length-1-r,n=t.shape.length-1-r;1===e.shape[i]||void 0===e.shape[i]?s.push(t.shape[n]):1===t.shape[n]||void 0===t.shape[n]?s.push(e.shape[i]):e.shape[i]===t.shape[n]&&s.push(t.shape[n])}return{shape:s.reverse(),type:t.type}}symbolicSource(){return[this.symbolic.totalLoops.join("\n"),this.symbolic.indices.A,this.symbolic.indices.B,this.symbolic.indices.R,this.symbolic.operation,"}".repeat(this.symbolic.totalLoopAxes.length)].join("\n")}}class R extends T{constructor(t,e,i){super(t,e,i,function(){return v.assign(this.symbolic.variables.R,v.add(this.symbolic.variables.A,this.symbolic.variables.B))})}}class z extends T{constructor(t,e,i){super(t,e,t,function(){return[v.assign(this.symbolic.variables.A,this.symbolic.variables.B),"R = A"]})}}class O extends T{constructor(t,e,i){super(t,e,i,function(){return v.divide(this.symbolic.variables.R,this.symbolic.variables.A,this.symbolic.variables.B)})}}class E extends T{constructor(t,e,i){super(t,e,i,function(){return v.assign(this.symbolic.variables.R,v.multiply(this.symbolic.variables.A,this.symbolic.variables.B))})}}class N extends T{constructor(t,e,i){super(t,e,i,function(){return v.assign(this.symbolic.variables.R,v.subtract(this.symbolic.variables.A,this.symbolic.variables.B))})}}class S{constructor(t,e,i){this.A=t,this.B=e,this.R=i,this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.pointwise.method=new Function("A,B,R",`${this.pointwise.source}; return R`),this.invoke=this.pointwise.method}static resultant(t){return{shape:[3,1],type:t.type}}pointwiseSource(){const t=[],e=[],i=[];for(let s=0;s<3;s++)t.push(v.variable({symbol:"A.data",index:this.A.header.flatIndex([s,0]),size:this.A.type.size})),e.push(v.variable({symbol:"B.data",index:this.B.header.flatIndex([s,0]),size:this.B.type.size})),i.push(v.variable({symbol:"R.data",index:this.R.header.flatIndex([s,0]),size:this.R.type.size}));return[v.assign(i[0],v.add(v.negate(v.multiply(t[2],e[1])),v.multiply(e[2],t[1]))),v.assign(i[1],v.add(v.negate(v.multiply(t[0],e[2])),v.multiply(e[0],t[2]))),v.assign(i[2],v.subtract(v.multiply(t[0],e[1]),v.multiply(e[0],t[1])))]}}const _=function(t){const e=[];for(let i=0;i<t;i++)for(let s=0;s<t;s++)e.push([i,s]);return e};class M{constructor(t,e,i){this.A=t,this.B=e,this.R=i,this.rows=this.A.shape[0],this.cols=this.A.shape[1],this.size=this.rows,this.matrixTemplate=_(this.size),this.pointwise={},this.pointwise.source=this.pointwiseSource(this.matrixTemplate),this.pointwise.method=new Function("A,B,R",`${this.pointwise.source}; return R`),this.invoke=this.pointwise.method}static fromAdjugate(t){return v.assign(v.variable({symbol:"determinant",size:t.A.type.size,index:0}),new Array(t.size).fill(null).map(function(e,i){return v.multiply(v.variable({symbol:"A.data",size:t.A.type.size,index:t.A.header.flatIndex([0,i])}),v.variable({symbol:"R.data",size:t.A.type.size,index:t.R.header.flatIndex([i,0])}))}).reduce(v.add))}static resultant(t){return{shape:[1,1],type:t.type.size}}pointwiseSource(t){if(1===t.length)return v.variable({symbol:"A.data",size:this.A.type.size,index:this.A.header.flatIndex(t[0])});const e=[],i=Math.sqrt(t.length);for(let s=0;s<i;s++){const i=M.minor(t,0,s),r=this.pointwiseSource(i),n=v.variable({symbol:"A.data",size:this.A.type.size,index:this.A.header.flatIndex(t[s])}),o=v.multiply(n,r);e.push(Math.pow(-1,s%2)>0?o:v.negate(o))}return e.reduce(v.add)}static minor(t,e,i){const s=Math.sqrt(t.length);return t.filter(function(t,r){return r%s!==i&&Math.floor(r/s)!==e})}}class F{constructor(t,e,i){this.A=t,this.B=e,this.R=i,this.size=this.A.shape[0],this.determinant=new M(t,e,i),this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.pointwise.method=new Function("A,B,R",`${this.pointwise.source}; return R`),this.invoke=this.pointwise.method}static resultant(t){return{shape:t.shape,type:t.type}}pointwiseSource(){const t=[];for(let e=0;e<this.size;e++)for(let i=0;i<this.size;i++){const s=Math.pow(-1,(e+i)%2),r=M.minor(_(this.size),i,e),n=this.determinant.pointwiseSource(r),o=s<0?v.negate(n):n;t.push(v.assign(v.variable({index:this.R.header.flatIndex([e,i]),symbol:"R.data",size:this.R.type.size}),o))}return t}}class P{constructor(t,e,i){this.A=t,this.B=e,this.R=i,this.rows=this.A.shape[0],this.cols=this.A.shape[1],this.size=this.rows,this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.pointwise.method=new Function("A,B,R",`\n            const temp = new Array(${this.A.type.size})\n            const determinant = new Array(${this.A.type.size})\n            ${this.pointwise.source.join("\n")};\n            return R\n        `),this.invoke=this.pointwise.method}static resultant(t){return{shape:t.shape,type:t.type}}pointwiseSource(){this.adjugate=new F(this.A,this.B,this.R),this.determinant=M.fromAdjugate(this.adjugate);const t=[];for(let e=0;e<this.size;e++)for(let i=0;i<this.size;i++){const s=v.variable({symbol:"determinant",size:this.A.type.size,index:0}),r=v.variable({index:this.R.header.flatIndex([e,i]),symbol:"R.data",size:this.R.type.size}),n=v.variable({symbol:"temp",size:this.A.type.size,index:0});t.push(v.divide(n,r,s)),t.push(v.assign(r,n))}return[this.adjugate.pointwise.source,this.determinant,t].flat(Number.POSITIVE_INFINITY)}}class C{constructor(t,e,i){if(this.A=t,this.B=e,this.R=i,this.rows=this.A.shape[0],this.cols=this.B.shape[1],this.like=this.A.shape[1],this.like>50)return this.symbolic={},this.symbolic.indices={},this.symbolic.indices.A="const AIndex = r * A.strides[0] + s * A.strides[1] + A.offset",this.symbolic.indices.B="const BIndex = r * B.strides[0] + s * B.strides[1] + B.offset",this.symbolic.indices.R="const RIndex = r * R.strides[0] + c * R.strides[1] + R.offset",this.symbolic.variables={},this.symbolic.variables.A=v.variable({symbol:"A.data",size:t.type.size,index:"AIndex"}),this.symbolic.variables.B=v.variable({symbol:"B.data",size:e.type.size,index:"BIndex"}),this.symbolic.variables.R=v.variable({symbol:"R.data",size:i.type.size,index:"RIndex"}),this.symbolic.source=this.symbolicSource(),this.symbolic.method=new Function("A,B,R",`${this.symbolic.source}; return R`),void(this.invoke=this.symbolic.method);this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.pointwise.method=new Function("A,B,R",`${this.pointwise.source}; return R`),this.invoke=this.pointwise.method}static resultant(t,e){return{shape:[t.shape[0],e.shape[1]],type:t.type}}symbolicSource(){return["for (let r = 0; r < A.shape[0]; r++){","for (let c = 0; c < B.shape[1]; c++){",this.symbolic.indices.R,"R.data[RIndex] = 0","for (let s = 0; s < A.shape[1]; s++) {",this.symbolic.indices.A,this.symbolic.indices.B,`${[v.assign(this.symbolic.variables.R,v.multiply(this.symbolic.variables.A,this.symbolic.variables.B),"+=")]}`,"}}}"].join("\n")}pointwiseSource(){const t=[];for(let e=0;e<this.rows;e++)for(let i=0;i<this.cols;i++)t.push(v.assign(v.variable({symbol:"R.data",size:this.R.type.size,index:this.R.header.flatIndex([e,i])}),new Array(this.like).fill(null).map(function(t,s){return v.multiply(v.variable({symbol:"A.data",size:this.A.type.size,index:this.A.header.flatIndex([e,s])}),v.variable({symbol:"B.data",size:this.B.type.size,index:this.B.header.flatIndex([s,i])}))},this).reduce(v.add)));return t.flat(Number.POSITIVE_INFINITY).join("\n")}}class B{constructor(t,e,i,s,r){this.A=t,this.B=e,this.R=i,this.symbolic={},this.symbolic.totalLoopAxes=[...new Array(this.A.shape.length).keys()],this.symbolic.innerLoopAxes=s||[...new Array(this.A.shape.length).keys()],this.symbolic.outerLoopAxes=this.symbolic.totalLoopAxes.filter(function(t){return!this.symbolic.innerLoopAxes.includes(t)},this),this.symbolic.outerLoops=this.symbolic.outerLoopAxes.map(A,this.A),this.symbolic.innerLoops=this.symbolic.innerLoopAxes.map(A,this.A),this.symbolic.innerSize=this.symbolic.innerLoopAxes.reduce(function(t,e){return t*this.A.shape[e]}.bind(this),1),this.symbolic.indices={},this.symbolic.indices.A=x("A",this.symbolic.totalLoopAxes,!0),this.symbolic.indices.R=x("R",this.symbolic.outerLoopAxes,!1),this.symbolic.variables={},this.symbolic.variables.T=v.variable({symbol:"temp",index:"0",size:this.R.type.size}),this.symbolic.variables.A=v.variable({symbol:"A.data",index:"AIndex",size:t.type.size}),this.symbolic.variables.R=v.variable({symbol:"R.data",index:"RIndex",size:this.R.type.size}),this.symbolic.operation=r.call(this),this.symbolic.source=this.symbolicSource(),this.symbolic.method=new Function("A,B,R",`${this.symbolic.source}; return R`),this.invoke=this.symbolic.method}static resultant(t,e,i,s=[...new Array(t.shape.length).keys()]){return{type:t.type,shape:t.shape.filter(function(t,e){return!s.includes(e)})}}symbolicSource(){return[`const temp = new Array(${this.A.type.size})`,this.symbolic.outerLoops.join("\n"),this.symbolic.indices.R,this.symbolic.operation.before,this.symbolic.innerLoops.join("\n"),this.symbolic.indices.A,this.symbolic.operation.inside,"}".repeat(this.symbolic.innerLoopAxes.length),this.symbolic.operation.after,"}".repeat(this.symbolic.outerLoopAxes.length)].join("\n")}}class j extends B{constructor(t,e,i,s=[]){super(t,e,i,s,function(){return{inside:v.assign(this.symbolic.variables.R,v.cos(this.symbolic.variables.A))}})}static resultant(t,e,i,s=[]){return super.resultant(t,e,i,s)}}class U extends B{constructor(t,e,i,s=[]){super(t,e,i,s,function(){return{inside:v.assign(this.symbolic.variables.R,v.exp(this.symbolic.variables.A))}})}static resultant(t,e,i,s=[]){return super.resultant(t,e,i,s)}}class $ extends B{constructor(t,e,i,s){super(t,e,i,s,function(){return{before:v.assign(this.symbolic.variables.T,v.NEGATIVE_INFINITY(this.symbolic.variables.T.length)),inside:v.if(v.greaterThan(this.symbolic.variables.A,this.symbolic.variables.T).slice(0,1),v.assign(this.symbolic.variables.T,this.symbolic.variables.A)),after:v.assign(this.symbolic.variables.R,this.symbolic.variables.T)}})}}class L extends B{constructor(t,e,i,s){super(t,e,i,s,function(){return{before:v.assign(this.symbolic.variables.T,v.ZERO(this.symbolic.variables.T.length)),inside:v.assign(this.symbolic.variables.T,this.symbolic.variables.A,"+="),after:v.assign(this.symbolic.variables.R,v.scale(this.symbolic.variables.T,1/this.symbolic.innerSize))}})}}class k extends B{constructor(t,e,i,s){super(t,e,i,s,function(){return{before:v.assign(this.symbolic.variables.T,v.ZERO(this.symbolic.variables.T.length)),inside:v.assign(this.symbolic.variables.T.slice(0,1),v.sum(v.square(this.symbolic.variables.A)),"+=").slice(0,1),after:v.assign(this.symbolic.variables.R,v.squareRoot(this.symbolic.variables.T))}})}static resultant(t,e){return{type:m.Float32,shape:[]}}}class D extends B{constructor(t,e,i,s=[]){super(t,e,i,s,function(){return{inside:v.assign(this.symbolic.variables.R,v.sin(this.symbolic.variables.A))}})}static resultant(t,e,i,s=[]){return super.resultant(t,e,i,s)}}class V extends B{constructor(t,e,i,s){super(t,e,i,s,function(){return{before:v.assign(this.symbolic.variables.T,v.ZERO(this.symbolic.variables.T.length)),inside:v.assign(this.symbolic.variables.T,this.symbolic.variables.A,"+="),after:v.assign(this.symbolic.variables.R,this.symbolic.variables.T)}})}}class Y extends B{constructor(t,e,i,s){super(t,e,i,s,function(){return{before:v.assign(this.symbolic.variables.T,v.POSITIVE_INFINITY(this.symbolic.variables.T.length)),inside:v.if(v.lessThan(this.symbolic.variables.A,this.symbolic.variables.T).slice(0,1),v.assign(this.symbolic.variables.T,this.symbolic.variables.A)),after:v.assign(this.symbolic.variables.R,this.symbolic.variables.T)}})}}class G extends B{constructor(t,e,i,s=[]){super(t,e,i,s,function(){return{inside:v.assign(this.symbolic.variables.R,v.negate(this.symbolic.variables.A))}})}static resultant(t,e,i,s=[]){return super.resultant(t,e,i,s)}}var H={...r,...n,...s};Object.assign(w,m),w.cache=new class extends Object{get(t,e,i,s){e||(e={id:""});let r=this;return(r=r[t.id])&&(r=r[e.id])&&(r=r[i.id])&&(r=r[s])?r:null}set(t,e,i,s,r){return e||(e={id:""}),this[t.id]=this[t.id]||{},this[t.id][e.id]=this[t.id][e.id]||{},this[t.id][e.id][i.id]=this[t.id][e.id][i.id]||{},this[t.id][e.id][i.id][s]=r,r}};for(const[t,e]of Object.entries(H))w[t]=function(i={}){const[s,r]=m.promote(w.tensor({data:i.of}),w.tensor({data:i.with})),n=i.axes,o=i.result||w.zeros(e.resultant(s,r,null,n));let a=w.cache.get(s,r,o,t);return a||(a=w.cache.set(s,r,o,t,new e(s,r,o,n))),a.invoke()},w.prototype[t]=function(i={}){const[s,r]=m.promote(this,w.tensor({data:i.with})),n=i.axes,o=i.result||w.zeros(e.resultant(s,r,null,n));let a=w.cache.get(s,r,o,t);return a||(a=w.cache.set(s,r,o,t,new e(s,r,o,n))),a.invoke(s,r,o)};var q=w;class X{constructor(t){this.context=t.context,this.mapType=this.mapType.bind(this),this.createBuffer=this.createBuffer.bind(this)}createBuffer({array:t}){const e=this.context.createBuffer(),i=this.mapType({array:t}),s=this.context.STATIC_DRAW,r=this.context.ARRAY_BUFFER;return this.context.bindBuffer(r,e),this.context.bufferData(r,t.data,s),{buffer:e,size:t.shape[1],count:t.shape[0],type:i,normalize:!1,offset:t.offset*t.data.BYTES_PER_ELEMENT,stride:t.strides[0]*t.data.BYTES_PER_ELEMENT}}mapType({array:t}){return t.type.typed===Int8Array?this.context.BYTE:t.type.typed===Uint8Array?this.context.UNSIGNED_BYTE:t.type.typed===Uint8ClampedArray?this.context.UNSIGNED_BYTE:t.type.typed===Int16Array?this.context.SHORT:t.type.typed===Uint16Array?this.context.UNSIGNED_SHORT:t.type.typed===Int32Array?this.context.INT:t.type.typed===Uint32Array?this.context.UNSIGNED_INT:t.type.typed===Float32Array?this.context.FLOAT:null}}var J={CONTEXT_2D:"2d",CONTEXT_WEB_GL:"webgl",HUD_FONT:"18px serif",HUD_COLOR:"rgba(255, 255, 255, 1)",HUD_TEXT_LOCATION:[10,50],CANVAS_STROKE_COLOR:"white",CANVAS_FILL_COLOR:"rgba(255, 165, 0, 1)",BINDINGS:{o:{name:"zoom",args:[!0]},i:{name:"zoom",args:[!1]},ArrowUp:{name:"pan",args:[0]},ArrowDown:{name:"pan",args:[1]},ArrowLeft:{name:"pan",args:[2]},ArrowRight:{name:"pan",args:[3]}},VERTEX_SOURCE:"attribute float a_PointSize;\nattribute vec4 a_Position;\nattribute vec4 a_Color;\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjMatrix;\nvarying vec4 v_Color;\nvoid main() {\n  gl_PointSize = a_PointSize;\n  gl_Position = u_ProjMatrix * u_ViewMatrix * a_Position;\n  v_Color = a_Color;\n}\n",FRAGMENT_SOURCE:"precision mediump float;\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n",TO_VECTOR:q.tensor({data:[[0],[0],[0],[1]],type:q.Float32}),UP_VECTOR:q.tensor({data:[[0],[1],[0],[1]],type:q.Float32}),FROM_VECTOR:q.tensor({data:[[200],[200],[200],[1]],type:q.Float32}),VIEWING_ANGLE:30,ASPECT_RATIO:1,NEAR:1e-6,FAR:1e6,ZOOM_DELTA:1.2,PAN_DELTA:Math.PI/32,ACTIVE_VERTICES:0,UP_DIRECTION:0,DOWN_DIRECTION:1,LEFT_DIRECTION:2,RIGHT_DIRECTION:3};class Q{constructor(){this.config=J,this.UP=this.config.UP_VECTOR,this.TO=this.config.TO_VECTOR,this.FROM=this.config.FROM_VECTOR;const t=Math.sin(this.config.PAN_DELTA),e=Math.cos(this.config.PAN_DELTA);this.upRot=q.tensor({data:[[1,0,0,0],[0,e,-t,0],[0,t,e,0],[0,0,0,1]],type:q.Float32}),this.downRot=q.tensor({data:[[1,0,0,0],[0,e,t,0],[0,-t,e,0],[0,0,0,1]],type:q.Float32}),this.leftRot=q.tensor({data:[[e,0,t,0],[0,1,0,0],[-t,0,e,0],[0,0,0,1]],type:q.Float32}),this.rightRot=q.tensor({data:[[e,0,-t,0],[0,1,0,0],[t,0,e,0],[0,0,0,1]],type:q.Float32})}lookAt(){return this.viewMatrix=q.eye({shape:[4,4],type:q.Float32}),this.transMatrix=q.eye({shape:[4,4],type:q.Float32}),this.f=this.FROM.subtract({with:this.TO}),this.s=this.UP.cross({with:this.f}),this.uf=this.f.divide({with:this.f.norm()}),this.us=this.s.divide({with:this.s.norm()}),this.uu=this.uf.cross({with:this.us}),this.viewMatrix.slice({region:[":3","0:1"]}).assign({with:this.us}),this.viewMatrix.slice({region:[":3","1:2"]}).assign({with:this.uu}),this.viewMatrix.slice({region:[":3","2:3"]}).assign({with:this.uf}),this.transMatrix.slice({region:["3:4",":3"]}).assign({with:this.FROM.negate().T()}),this.transMatrix.matMult({with:this.viewMatrix})}project(){const t=Math.PI*this.config.VIEWING_ANGLE/180/2,e=1/(this.config.FAR-this.config.NEAR),i=Math.sin(t),s=Math.cos(t)/i,r=new Float32Array(16);return r[0]=s/this.config.ASPECT_RATIO,r[5]=s,r[10]=-(this.config.FAR+this.config.NEAR)*e,r[11]=-1,r[14]=-2*this.config.NEAR*this.config.FAR*e,q.tensor({data:r,type:q.Float32}).reshape({shape:[4,4]})}rotate({orientation:t,viewMatrix:e,viewMatrixInv:i}){i.T().matMult({with:t}).matMult({with:e.T()}).matMult({with:this.TO,result:this.TO})}pan(t){const e=this.lookAt(),i=e.inverse();switch(t){case this.config.UP_DIRECTION:return this.rotate({orientation:this.upRot,viewMatrix:e,viewMatrixInv:i});case this.config.DOWN_DIRECTION:return this.rotate({orientation:this.downRot,viewMatrix:e,viewMatrixInv:i});case this.config.LEFT_DIRECTION:return this.rotate({orientation:this.leftRot,viewMatrix:e,viewMatrixInv:i});case this.config.RIGHT_DIRECTION:return this.rotate({orientation:this.rightRot,viewMatrix:e,viewMatrixInv:i})}}zoom(t){const e=t?"add":"subtract",i=this.FROM.subtract({with:this.TO}).multiply({with:this.config.ZOOM_DELTA});this.TO[e]({with:i,result:this.TO}),this.FROM[e]({with:i,result:this.FROM})}}class W{constructor(t){this.config=J,this.context=t.context,this.vertexShader=this.createShader({type:this.context.VERTEX_SHADER,source:J.VERTEX_SOURCE}),this.fragmentShader=this.createShader({type:this.context.FRAGMENT_SHADER,source:J.FRAGMENT_SOURCE}),this.program=this.createProgram()}createShader({type:t,source:e}){const i=this.context.createShader(t);return this.context.shaderSource(i,e),this.context.compileShader(i),this.context.getShaderParameter(i,this.context.COMPILE_STATUS)?i:(console.error(`Error with compile: ${this.context.getShaderInfoLog(i)}`),this.context.deleteShader(i),null)}createProgram(){const t=this.context.createProgram();return this.context.attachShader(t,this.vertexShader),this.context.attachShader(t,this.fragmentShader),this.context.linkProgram(t),this.context.getProgramParameter(t,this.context.LINK_STATUS)?t:(console.error(`Error with link: ${this.context.getProgramInfoLog(t)}`),this.context.deleteProgram(t),null)}}class Z{constructor(t){this.context=t.context,this.program=t.program,this.uniforms=this.createUniforms()}createUniforms(){const t={},e=this.context.getProgramParameter(this.program,this.context.ACTIVE_UNIFORMS);for(let i=0;i<e;i++){const e=this.context.getActiveUniform(this.program,i),s=this.context.getUniformLocation(this.program,e.name);t[e.name]=this.createUniform({type:e.type,location:s})}return t}createUniform({type:t,location:e}){return t===this.context.FLOAT_MAT2?function(t){this.context.uniformMatrix2fv(e,!1,t.data)}.bind(this):t===this.context.FLOAT_MAT3?function(t){this.context.uniformMatrix3fv(e,!1,t.data)}.bind(this):t===this.context.FLOAT_MAT4?function(t){this.context.uniformMatrix4fv(e,!1,t.data)}.bind(this):void 0}}class K{constructor(t){this.program=t.program,this.context=t.context,this.attributes=this.createAttributes()}createAttributes(){const t={},e=this.context.getProgramParameter(this.program,this.context.ACTIVE_ATTRIBUTES);for(var i=0;i<e;i++){const e=this.context.getActiveAttrib(this.program,i),s=this.context.getAttribLocation(this.program,e.name);t[e.name]=this.createAttribute({location:s})}return t}createAttribute({location:t}){return function(e){this.context.bindBuffer(this.context.ARRAY_BUFFER,e.buffer),this.context.enableVertexAttribArray(t),this.context.vertexAttribPointer(t,e.size,e.type,e.normalize,e.stride,e.offset)}.bind(this)}}class tt{constructor(){this.config=J,this.objects=[],this.pan=this.pan.bind(this),this.zoom=this.zoom.bind(this),this.plot=this.plot.bind(this),this.start=this.start.bind(this),this.render=this.render.bind(this),this.start()}start(){return this.hud=document.createElement("canvas"),this.hud.style.zIndex=this.config.HUD_Z_INDEX,this.hud.style.position=this.config.HUD_POSITION_STYLE,this.canvas=document.createElement("canvas"),this.canvas.style.zIndex=this.config.CANVAS_Z_INDEX,this.canvas.style.position=this.config.CANVAS_POSITION_STYLE,this.resize(),this.canvas.context=this.canvas.getContext(this.config.CONTEXT_WEB_GL),this.cameraManager=new Q({}),this.bufferManager=new X({context:this.canvas.context}),this.programManager=new W({context:this.canvas.context}),this.uniformManager=new Z({context:this.canvas.context,program:this.programManager.program}),this.attributeManager=new K({context:this.canvas.context,program:this.programManager.program}),this.canvas.context.useProgram(this.programManager.program),this.hud.context=this.hud.getContext(this.config.CONTEXT_2D),this.hud.context.font=this.config.HUD_FONT,this.hud.context.fillStyle=this.config.HUD_COLOR,document.body.prepend(this.hud),document.body.prepend(this.canvas),this}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.hud.width=.5*window.innerWidth,this.hud.height=.2*window.innerHeight,this.config.ASPECT_RATIO=this.canvas.width/this.canvas.height}plot({vertices:t,colors:e,sizes:i,mode:s}){this.objects.push({sizeBuffer:this.bufferManager.createBuffer({array:i}),colorBuffer:this.bufferManager.createBuffer({array:e}),vertexBuffer:this.bufferManager.createBuffer({array:t}),drawMode:this.canvas.context[s],drawCount:t.shape[0]}),this.render()}render(){this.canvas.context.clear(this.canvas.context.COLOR_BUFFER_BIT);for(const t of this.objects)this.attributeManager.attributes.a_Color(t.colorBuffer),this.attributeManager.attributes.a_PointSize(t.sizeBuffer),this.attributeManager.attributes.a_Position(t.vertexBuffer),this.uniformManager.uniforms.u_ViewMatrix(this.cameraManager.lookAt()),this.uniformManager.uniforms.u_ProjMatrix(this.cameraManager.project()),this.canvas.context.drawArrays(t.drawMode,0,t.drawCount)}pan(t){this.cameraManager.pan(t),this.render()}zoom(t){this.cameraManager.zoom(t),this.hud.context.clearRect(0,0,this.hud.width,this.hud.height),this.hud.context.fillText(`loc | r: ${Math.round(this.config.FROM_VECTOR.data[0])} g: ${Math.round(this.config.FROM_VECTOR.data[1])}, b: ${Math.round(this.config.FROM_VECTOR.data[2])}`,10,70),this.render()}}class et{constructor(t){this.isPressed=t.isPressed||!1,this.position=t.position||{x:0,y:0}}mouseup(){this.isPressed=!1}mousedown(t){this.isPressed=!0,this.position.x=t.clientX,this.position.y=t.clientY}mousemove(t){this.position.x=t.clientX,this.position.y=t.clientY}}class it{constructor(t){this.keys=t.keys||new Set,this.bindings=t.bindings}keyup(){this.keys.clear()}keydown(t){this.keys.add(t.key);const e=Array.from(this.keys).sort().join("|");return this.bindings[e]}}var st=new class{constructor(){this.config=J,this.keyup=this.keyup.bind(this),this.resize=this.resize.bind(this),this.keydown=this.keydown.bind(this),this.mouseup=this.mouseup.bind(this),this.mousedown=this.mousedown.bind(this),this.mousemove=this.mousemove.bind(this),this.mouse=new et({location:{x:0,y:0}}),this.keyboard=new it({bindings:this.config.BINDINGS}),this.graphics=new tt({}),window.addEventListener("resize",this.resize),window.addEventListener("keyup",this.keyup),window.addEventListener("keydown",this.keydown),window.addEventListener("mouseup",this.mouseup),window.addEventListener("mousedown",this.mousedown),window.addEventListener("mousemove",this.mousemove)}mouseup(){this.mouse.mouseup()}mousedown(t){this.mouse.mousedown(t)}mousemove(t){this.mouse.mousemove(t)}keyup(){this.keyboard.keyup()}keydown(t){const e=this.keyboard.keydown(t);if(e){t.preventDefault(),(0,this.graphics[e.name])(...e.args)}}resize(){this.graphics.resize()}};window.bb=q,window.myio=class{static async imread(t){const e=document.createElement("canvas"),i=e.getContext("2d"),s=await fetch(t),r=await s.blob(),n=await createImageBitmap(r),o=[0,0,n.width,n.height];e.width=n.width,e.height=n.height,i.drawImage(n,...o),e.remove();let a=i.getImageData(...o).data;const c=new Uint8ClampedArray(n.width*n.height*3);for(let t=0,e=0;t<a.length;t+=4,e+=3)c[e]=a[t],c[e+1]=a[t+1],c[e+2]=a[t+2];return a=null,{shape:[n.width,n.height,3],pixels:c,binary:n}}},window.app=st;e.default=async function(){window.sin=q.arange({stop:1e4}).divide({with:10}).sin().multiply({with:3}),window.cos=q.arange({stop:1e4}).divide({with:10}).cos().multiply({with:3}),window.axis=q.linspace({start:0,stop:2*Math.PI,num:1e4}).multiply({with:"i"}),window.vertices=q.zeros({shape:[1e4,3],type:q.ComplexFloat32}),vertices.slice({region:[":",0]}).assign({with:axis.exp().multiply({with:250})}),window.colors=q.zeros({shape:[1e4,3]}),colors.slice({region:[":",":2"]}).assign({with:255}),window.sizes=q.ones({shape:[1e4,1]}).multiply({with:1}),app.graphics.plot({vertices:vertices,colors:colors,sizes:sizes,mode:"POINTS"})}()}]);
//# sourceMappingURL=main.js.map