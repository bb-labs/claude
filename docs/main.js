!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e,s){(function(t){var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),s={},i=0;i<e.length;i++)s[e[i]]=Object.getOwnPropertyDescriptor(t,e[i]);return s},n=/%[sdj%]/g;e.format=function(t){if(!m(t)){for(var e=[],s=0;s<arguments.length;s++)e.push(a(arguments[s]));return e.join(" ")}s=1;for(var i=arguments,r=i.length,o=String(t).replace(n,function(t){if("%%"===t)return"%";if(s>=r)return t;switch(t){case"%s":return String(i[s++]);case"%d":return Number(i[s++]);case"%j":try{return JSON.stringify(i[s++])}catch(t){return"[Circular]"}default:return t}}),h=i[s];s<r;h=i[++s])y(h)||!w(h)?o+=" "+h:o+=" "+a(h);return o},e.deprecate=function(s,i){if(void 0!==t&&!0===t.noDeprecation)return s;if(void 0===t)return function(){return e.deprecate(s,i).apply(this,arguments)};var n=!1;return function(){if(!n){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),n=!0}return s.apply(this,arguments)}};var r,o={};function a(t,s){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),f(s)?i.showHidden=s:s&&e._extend(i,s),x(i.showHidden)&&(i.showHidden=!1),x(i.depth)&&(i.depth=2),x(i.colors)&&(i.colors=!1),x(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=h),u(i,t,i.depth)}function h(t,e){var s=a.styles[e];return s?"["+a.colors[s][0]+"m"+t+"["+a.colors[s][1]+"m":t}function c(t,e){return t}function u(t,s,i){if(t.customInspect&&s&&I(s.inspect)&&s.inspect!==e.inspect&&(!s.constructor||s.constructor.prototype!==s)){var n=s.inspect(i,t);return m(n)||(n=u(t,n,i)),n}var r=function(t,e){if(x(e))return t.stylize("undefined","undefined");if(m(e)){var s="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(s,"string")}if(g(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(y(e))return t.stylize("null","null")}(t,s);if(r)return r;var o=Object.keys(s),a=function(t){var e={};return t.forEach(function(t,s){e[t]=!0}),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(s)),A(s)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return l(s);if(0===o.length){if(I(s)){var h=s.name?": "+s.name:"";return t.stylize("[Function"+h+"]","special")}if(b(s))return t.stylize(RegExp.prototype.toString.call(s),"regexp");if(v(s))return t.stylize(Date.prototype.toString.call(s),"date");if(A(s))return l(s)}var c,w="",R=!1,T=["{","}"];(d(s)&&(R=!0,T=["[","]"]),I(s))&&(w=" [Function"+(s.name?": "+s.name:"")+"]");return b(s)&&(w=" "+RegExp.prototype.toString.call(s)),v(s)&&(w=" "+Date.prototype.toUTCString.call(s)),A(s)&&(w=" "+l(s)),0!==o.length||R&&0!=s.length?i<0?b(s)?t.stylize(RegExp.prototype.toString.call(s),"regexp"):t.stylize("[Object]","special"):(t.seen.push(s),c=R?function(t,e,s,i,n){for(var r=[],o=0,a=e.length;o<a;++o)N(e,String(o))?r.push(p(t,e,s,i,String(o),!0)):r.push("");return n.forEach(function(n){n.match(/^\d+$/)||r.push(p(t,e,s,i,n,!0))}),r}(t,s,i,a,o):o.map(function(e){return p(t,s,i,a,e,R)}),t.seen.pop(),function(t,e,s){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return s[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+s[1];return s[0]+e+" "+t.join(", ")+" "+s[1]}(c,w,T)):T[0]+w+T[1]}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,s,i,n,r){var o,a,h;if((h=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?a=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(a=t.stylize("[Setter]","special")),N(i,n)||(o="["+n+"]"),a||(t.seen.indexOf(h.value)<0?(a=y(s)?u(t,h.value,null):u(t,h.value,s-1)).indexOf("\n")>-1&&(a=r?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),x(o)){if(r&&n.match(/^\d+$/))return a;(o=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function d(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function y(t){return null===t}function g(t){return"number"==typeof t}function m(t){return"string"==typeof t}function x(t){return void 0===t}function b(t){return w(t)&&"[object RegExp]"===R(t)}function w(t){return"object"==typeof t&&null!==t}function v(t){return w(t)&&"[object Date]"===R(t)}function A(t){return w(t)&&("[object Error]"===R(t)||t instanceof Error)}function I(t){return"function"==typeof t}function R(t){return Object.prototype.toString.call(t)}function T(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(s){if(x(r)&&(r=t.env.NODE_DEBUG||""),s=s.toUpperCase(),!o[s])if(new RegExp("\\b"+s+"\\b","i").test(r)){var i=t.pid;o[s]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",s,i,t)}}else o[s]=function(){};return o[s]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=f,e.isNull=y,e.isNullOrUndefined=function(t){return null==t},e.isNumber=g,e.isString=m,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=x,e.isRegExp=b,e.isObject=w,e.isDate=v,e.isError=A,e.isFunction=I,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=s(2);var z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(){var t=new Date,e=[T(t.getHours()),T(t.getMinutes()),T(t.getSeconds())].join(":");return[t.getDate(),z[t.getMonth()],e].join(" ")}function N(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",O(),e.format.apply(e,arguments))},e.inherits=s(3),e._extend=function(t,e){if(!e||!w(e))return t;for(var s=Object.keys(e),i=s.length;i--;)t[s[i]]=e[s[i]];return t};var E="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function _(t,e){if(!t){var s=new Error("Promise was rejected with a falsy value");s.reason=t,t=s}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(E&&t[E]){var e;if("function"!=typeof(e=t[E]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,s,i=new Promise(function(t,i){e=t,s=i}),n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);n.push(function(t,i){t?s(t):e(i)});try{t.apply(this,n)}catch(t){s(t)}return i}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),E&&Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=E,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function s(){for(var s=[],i=0;i<arguments.length;i++)s.push(arguments[i]);var n=s.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var r=this,o=function(){return n.apply(r,arguments)};e.apply(this,s).then(function(e){t.nextTick(o,null,e)},function(e){t.nextTick(_,e,o)})}return Object.setPrototypeOf(s,Object.getPrototypeOf(e)),Object.defineProperties(s,i(e)),s}}).call(this,s(1))},function(t,e){var s,i,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var h,c=[],u=!1,l=-1;function p(){u&&h&&(u=!1,h.length?c=h.concat(c):l=-1,c.length&&d())}function d(){if(!u){var t=a(p);u=!0;for(var e=c.length;e;){for(h=c,c=[];++l<e;)h&&h[l].run();l=-1,e=c.length}h=null,u=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function y(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)e[s-1]=arguments[s];c.push(new f(t,e)),1!==c.length||u||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=y,n.addListener=y,n.once=y,n.off=y,n.removeListener=y,n.removeAllListeners=y,n.emit=y,n.prependListener=y,n.prependOnceListener=y,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t}},function(t,e,s){"use strict";s.r(e);var i={};s.r(i),s.d(i,"cos",function(){return I}),s.d(i,"max",function(){return R}),s.d(i,"sin",function(){return T}),s.d(i,"sum",function(){return z}),s.d(i,"min",function(){return O}),s.d(i,"mean",function(){return N}),s.d(i,"norm",function(){return E}),s.d(i,"unit",function(){return F}),s.d(i,"repeat",function(){return j}),s.d(i,"negation",function(){return M}),s.d(i,"exponential",function(){return P});var n={};s.r(n),s.d(n,"addition",function(){return B}),s.d(n,"division",function(){return S}),s.d(n,"assignment",function(){return C}),s.d(n,"subtraction",function(){return k}),s.d(n,"multiplication",function(){return U});var r={};s.r(r),s.d(r,"cross",function(){return $}),s.d(r,"inverse",function(){return Y}),s.d(r,"matMult",function(){return G}),s.d(r,"adjugate",function(){return L}),s.d(r,"determinant",function(){return V});const o=/ +/g,a=/\d+/,h=":",c=/\d*:\d*/,u="],\n$1[",l=/\]\,(\s*)\[/g,p=/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g,d={0:"",1:"i",2:"j",3:"k"},f={"":0,i:1,I:1,j:2,J:2,k:3,K:3},y=Object.assign(Math,{add:function(t,e){return t+e},subtract:function(t,e){return t-e},divide:function(t,e){return t/e},multiply:function(t,e){return t*e}});class g{constructor({size:t,typed:e}){this.size=t,this.typed=e}static promote(t,e){if(!e.type)return[t,e];const s=t.type.size>e.type.size?t.type:e.type;return[t.astype({type:s}),e.astype({type:s})]}static isTypedArray(t){return void 0!==t&&(t.constructor===Int8Array||t.constructor===Int16Array||t.constructor===Int32Array||t.constructor===Uint8Array||t.constructor===Uint16Array||t.constructor===Uint32Array||t.constructor===Float32Array||t.constructor===Float64Array||t.constructor===Uint8ClampedArray)}static resolve(t){const e=g.parse(t);return 1===e.length?g.Float32:2===e.length?g.ComplexFloat32:e.length>2?g.QuatFloat32:void 0}static parse(t){let e,s=1;const i=[],n=String(t).match(p).filter(function(t){return!o.test(t)});for(let t=0;t<n.length;t++)if((e=n[t])in f)isNaN(n[t-1])&&(i[f[e]]=i[f[e]]||0,i[f[e]]+=s);else if("+"===e)s=1;else if("-"===e)s=-1;else if(!isNaN(e)){let r=n[t+1];r in f?(i[f[r]]=i[f[r]]||0,i[f[r]]+=s*Number(e)):(i[0]=i[0]||0,i[0]+=s*Number(e))}return i}array(t){return g.isTypedArray(t)?t:t.constructor===Array?new this.typed(t.flatMap(function(t){return this.align(g.parse(t))},this)):t.constructor===Number?new this.typed(t*this.size):void 0}align(t){return t.length=this.size,Array.from(t,function(t){return t||0})}}g.Int8=new class extends g{}({size:1,typed:Int8Array}),g.Int16=new class extends g{}({size:1,typed:Int16Array}),g.Int32=new class extends g{}({size:1,typed:Int32Array}),g.Uint8=new class extends g{}({size:1,typed:Uint8Array}),g.Uint16=new class extends g{}({size:1,typed:Uint16Array}),g.Uint32=new class extends g{}({size:1,typed:Uint32Array}),g.Float32=new class extends g{}({size:1,typed:Float32Array}),g.Float64=new class extends g{}({size:1,typed:Float64Array}),g.Uint8Clamped=new class extends g{}({size:1,typed:Uint8ClampedArray}),g.ComplexInt8=new class extends g{}({size:2,typed:Int8Array}),g.ComplexInt16=new class extends g{}({size:2,typed:Int16Array}),g.ComplexInt32=new class extends g{}({size:2,typed:Int32Array}),g.ComplexUint8=new class extends g{}({size:2,typed:Uint8Array}),g.ComplexUint16=new class extends g{}({size:2,typed:Uint16Array}),g.ComplexUint32=new class extends g{}({size:2,typed:Uint32Array}),g.ComplexFloat32=new class extends g{}({size:2,typed:Float32Array}),g.ComplexFloat64=new class extends g{}({size:2,typed:Float64Array}),g.ComplexUint8Clamped=new class extends g{}({size:2,typed:Uint8ClampedArray}),g.QuatInt8=new class extends g{}({size:4,typed:Int8Array}),g.QuatInt16=new class extends g{}({size:4,typed:Int16Array}),g.QuatInt32=new class extends g{}({size:4,typed:Int32Array}),g.QuatUint8=new class extends g{}({size:4,typed:Uint8Array}),g.QuatUint16=new class extends g{}({size:4,typed:Uint16Array}),g.QuatUint32=new class extends g{}({size:4,typed:Uint32Array}),g.QuatFloat32=new class extends g{}({size:4,typed:Float32Array}),g.QuatFloat64=new class extends g{}({size:4,typed:Float64Array}),g.QuatUint8Clamped=new class extends g{}({size:4,typed:Uint8ClampedArray});var m=s(0);class x{constructor(t){this.type=void 0!==t.type?t.type:g.Float32,this.shape=void 0!==t.shape?t.shape:[],this.offset=void 0!==t.offset?t.offset:0,this.contig=void 0===t.contig||t.contig,this.strides=void 0!==t.strides?t.strides:x.strides(this.shape,this.type),this.size=this.shape.reduce(y.multiply,1),this.lastStride=this.strides[this.strides.length-1]}static isContigous(t){let e=-1;for(let s=0;s<t.length;s++){if(e>=0&&t[s].constructor===String&&s-e>1)return!1;t[s].constructor===String&&(e=s)}return!0}static nonZeroAxes(t,e){const s=this.shape.length-e-1;return!(s<0)&&this.shape[s]>1}static strides(t,e,s){const i=new Array(t.length);let n=s||e.size;i[i.length-1]=n;for(let e=t.length-1;e>0;e--)i[e-1]=n*=t[e];return i}static reshape(t,e){const s=new Array(t.length),i=t.reduce(y.multiply,1);for(let n=0;n<t.length;n++)s[n]=t[n]<0?-e/i:t[n];return s}copy(){return new x(JSON.parse(JSON.stringify(this)))}flatIndex(t){let e=this.offset;for(let s=0;s<t.length;s++)e+=t[s]*this.strides[s];return e}slice(t){const e=new Array,s=new Array,i=x.isContigous(t);let n=this.offset;for(let i=0;i<this.shape.length;i++)if(t[i]===h||void 0===t[i])e.push(this.shape[i]),s.push(this.strides[i]);else if(c.test(t[i])){let[r,o]=t[i].split(h).map(Number);0===o&&(o=this.shape[i]),n+=this.strides[i]*r,e.push(o-r),s.push(this.strides[i])}else a.test(t[i])&&(n+=this.strides[i]*t[i]);return new x({shape:e,strides:s,offset:n,contig:i,type:this.type})}transpose(){return new x({type:this.type,shape:this.shape.slice().reverse(),strides:this.strides.slice().reverse(),offset:this.offset,contig:!1})}reshape(t){const e=x.reshape(t,this.size),s=x.strides(e,this.type,this.lastStride);return new x({type:this.type,shape:e,strides:s})}}class b{constructor({header:t,data:e}){Object.assign(this,this.header=t),this.data=this.type.array(e||this.size)}static intersection(t,e){return t.constructor===b&&e.constructor===b&&(t=t.toRawFlat(),e=e.toRawFlat()),t.filter(function(t){return e.includes(t)})}static difference(t,e){return t.constructor===b&&e.constructor===b&&(t=t.toRawFlat(),e=e.toRawFlat()),t.filter(function(t){return!e.includes(t)})}static shape(t,e=[]){return t.constructor===b?t.shape:g.isTypedArray(t)?[t.length]:t.constructor!==Array?e:b.shape(t[0],e.concat(t.length))}static tensor({data:t,type:e}){if(void 0===t)return{};if(t.constructor===b)return t;const s=b.shape(t);return t.constructor!==String&&t.constructor!==Number&&t.constructor!==Array||(t=[t].flat(Number.POSITIVE_INFINITY)),e=e||g.resolve(t[0]),new b({data:t,header:new x({type:e,shape:s})})}static zerosLike({tensor:t}){return new b({header:new x({...t})})}static zeros({shape:t,type:e}={}){return t?new b({header:new x({shape:t,type:e})}):{}}static onesLike({tensor:t}){return(t=new b({header:new x({...t})})).data.fill(1),t}static ones({shape:t,type:e}){const s=new b({header:new x({shape:t,type:e})});return s.data.fill(1),s}static arange({start:t=0,step:e=1,stop:s,type:i}){const n=new b({header:new x({type:i,shape:[y.round((s-t)/e)]})});for(let i=t,r=0;i<s;i+=e,r++)n.data[r]=i;return n}static linspace({start:t,stop:e,num:s=50,type:i}){const n=(e-t)/s,r=new b({header:new x({type:i,shape:[s]})});for(let s=t,i=0;s<e;s+=n,i+=r.type.size)r.data[i]=s;return r}static rand({shape:t,type:e}){const s=new b({header:new x({shape:t,type:e})});for(let t=0;t<s.data.length;t++)s.data[t]=y.random()-1;return s}static randrange({low:t,high:e,shape:s,type:i}){const n=new b({header:new x({shape:s,type:i})});for(let s=0;s<n.data.length;s++)n.data[s]=t+y.floor(y.random()*(e-t));return n}static eye({shape:t,type:e}){const s=new b({header:new x({shape:t,type:e})}),i=s.strides.reduce(y.add),n=y.min(...s.shape);for(let t=0;t<n*i;t+=i)s.data[t]=1;return s}astype({type:t}){if(t===this.type)return this;if(1===this.size)return this;const e=this.toRaw().flat(Number.POSITIVE_INFINITY),s=t.array(this.size);for(let i=0,n=0;i<e.length;i+=this.type.size,n+=t.size)for(let r=0;r<Math.min(t.size,this.type.size);r++)s[n+r]=e[i+r];return new b({header:new x({type:t,shape:this.shape}),data:s})}copy(){return new b({header:this.header,data:this.data.slice()})}ravel(){return b.tensor({data:this.toRaw(),type:this.type}).reshape({shape:[-1]})}slice({region:t}){return new b({header:this.header.slice(t),data:this.data})}T(){return new b({header:this.header.transpose(),data:this.data})}reshape({shape:t}){return this.contig?new b({header:this.header.reshape(t),data:this.data}):b.tensor({data:this.toRaw(),type:this.type}).reshape({shape:t})}visit(t=this.toStringAtIndex.bind(this),e=this.offset,s=0){return this.shape.length&&s!==this.shape.length?[...new Array(this.shape[s]).keys()].map(function(i){return this.visit(t,i*this.strides[s]+e,s+1)},this):t(e)}toRaw(){return this.visit()}toRawFlat(){return this.visit().flat(Number.POSITIVE_INFINITY)}toIndices(){const t=[];return this.visit(function(e){t.push(e)}),t}valueOf(){return this.data[this.offset]}toStringAtIndex(t,e=""){for(let s=0;s<this.type.size;s++){const i=Math.sign(this.data[t+s])<0?"-":"+",n=Math.abs(this.data[t+s]);n&&(e+=`${i}${n.toPrecision()}${d[s]}`)}return e?e.startsWith("+")?e.slice(1):e:"0"}toString(){return JSON.stringify(this.toRaw()).replace(l,u)}[m.inspect.custom](){return this.toString()}}class w{static split(t=[],e=[]){return[t.slice(0,t.length/2),t.slice(t.length/2),e.slice(0,e.length/2),e.slice(e.length/2)]}static match(t,e){const s=Math.max(t.length,e.length);return t.length=s,e.length=s,[Array.from(t,function(t){return t||0}),Array.from(e,function(t){return t||0})]}static variable({symbol:t,size:e,index:s}){return new Array(e).fill(null).map(function(e,i){return`${t}[${s}+${i}]`})}static ONE(t){return new Array(t).fill(1)}static ZERO(t){return new Array(t).fill(0)}static POSITIVE_INFINITY(t){return Array(t).fill(Number.POSITIVE_INFINITY)}static NEGATIVE_INFINITY(t){return Array(t).fill(Number.NEGATIVE_INFINITY)}static if(t,e){return`if(${t}){\n            ${e}\n        }`}static noop(t,e){if([t,e]=w.match(t,e),1===t.length)return[`(${t})`];const[s,i,n,r]=w.split(t,e);return[w.noop(s,n),w.noop(i,r)].flat(Number.POSITIVE_INFINITY)}static exp(t){if(1===t.length)return[`Math.exp(${t})`];const[e,s]=w.split(t);return 2===t.length?w.scale([w.cos(s),w.sin(s)],w.exp(e)):[w.exp(e),w.exp(s)].flat(Number.POSITIVE_INFINITY)}static sin(t){if(1===t.length)return[`Math.sin(${t})`];const[e,s]=w.split(t);return[w.sin(e),w.sin(s)].flat(Number.POSITIVE_INFINITY)}static cos(t){if(1===t.length)return[`Math.cos(${t})`];const[e,s]=w.split(t);return[w.cos(e),w.cos(s)].flat(Number.POSITIVE_INFINITY)}static lessThan(t,e){if([t,e]=w.match(t,e),1===t.length)return[`(${t}<${e})`];const[s,i,n,r]=w.split(t,e);return[w.lessThan(s,n),w.lessThan(i,r)].flat(Number.POSITIVE_INFINITY)}static greaterThan(t,e){if([t,e]=w.match(t,e),1===t.length)return[`(${t}>${e})`];const[s,i,n,r]=w.split(t,e);return[w.greaterThan(s,n),w.greaterThan(i,r)].flat(Number.POSITIVE_INFINITY)}static add(t,e){if([t,e]=w.match(t,e),1===t.length)return[`(${t}+${e})`];const[s,i,n,r]=w.split(t,e);return[w.add(s,n),w.add(i,r)].flat(Number.POSITIVE_INFINITY)}static subtract(t,e){if([t,e]=w.match(t,e),1===t.length)return[`(${t}-${e})`];const[s,i,n,r]=w.split(t,e);return[w.subtract(s,n),w.subtract(i,r)].flat(Number.POSITIVE_INFINITY)}static multiply(t,e){if([t,e]=w.match(t,e),1===t.length)return[`${t}*${e}`];const[s,i,n,r]=w.split(t,e);return[w.subtract(w.multiply(s,n),w.multiply(w.conjugate(r),i)),w.add(w.multiply(r,s),w.multiply(i,w.conjugate(n)))].flat(Number.POSITIVE_INFINITY)}static divide(t,e,s){return[e,s]=w.match(e,s),1===e.length?[`${t}=(${e}/${s})`]:[`var mod = (1/${w.sum(w.square(s))})`,w.assign(t,w.scale(w.multiply(e,w.conjugate(s)),"mod"))].join("\n")}static squareRoot(t){if(1===t.length)return[`Math.sqrt(${t})`];const[e,s]=w.split(t);return[w.squareRoot(e),w.squareRoot(s)].flat(Number.POSITIVE_INFINITY)}static sum(t){if(1===t.length)return[`(${t})`];const[e,s]=w.split(t);return w.add(w.sum(e),w.sum(s))}static scale(t,e){if(1===t.length)return[`(${t}*${e})`];const[s,i]=w.split(t);return[w.scale(s,e),w.scale(i,e)].flat(Number.POSITIVE_INFINITY)}static square(t){if(1===t.length)return[`(${t}*${t})`];const[e,s]=w.split(t);return[w.square(e),w.square(s)].flat(Number.POSITIVE_INFINITY)}static conjugate(t){if(1===t.length)return[`(${t})`];const[e,s]=w.split(t);return[w.conjugate(e),w.negate(s)].flat(Number.POSITIVE_INFINITY)}static negate(t){if(1===t.length)return[`-(${t})`];const[e,s]=w.split(t);return[w.negate(e),w.negate(s)].flat(Number.POSITIVE_INFINITY)}static assign(t,e,s="="){if(1===t.length)return[`${t}${s}${e}`];const[i,n,r,o]=w.split(t,e);return[w.assign(i,r,s),w.assign(n,o,s)].flat(Number.POSITIVE_INFINITY)}}class v{static loop(t,e,s){return`for(${t}; ${e}; ${s}){`}static loopAxes(t,e){return t.map(function(t){return v.loop([`let i${t} = 0`],[`i${t} < ${e.shape[t]}`],[`i${t}++`])})}static prefix(t){return`i${t}`}static index(t,e,s,i){return new Array(s.length).fill(null).reduce(function(t,i,n){return`${t} + ${s[n]} * ${e[n]}`},`const ${t} = ${i}`)}}class A{constructor(t){this.tensors={},this.tensors.A=b.tensor({data:t.of}),this.axes={},this.axes.inner=t.axes||[],this.axes.total=[...this.tensors.A.shape.keys()],this.axes.outer=b.difference(this.axes.total,this.axes.inner),this.axes.A=this.axes.total,this.axes.R=this.axes.outer,this.tensors.R=t.result||this.resultant(),this.dimensions={},this.dimensions.inner=this.axes.inner.reduce(function(t,e){return t*this.tensors.A.shape[e]}.bind(this),1),this.dimensions.outer=this.axes.inner.reduce(function(t,e){return t*this.tensors.A.shape[e]}.bind(this),1),this.loops={},this.loops.total=v.loopAxes(this.axes.total,this.tensors.A),this.loops.outer=v.loopAxes(this.axes.outer,this.tensors.A),this.loops.inner=v.loopAxes(this.axes.inner,this.tensors.A),this.strides={},this.strides.A=this.tensors.A.strides,this.strides.R=this.tensors.R.strides,this.indices={},this.scalars={},this.scalars.A=this.axes.total.map(v.prefix),this.scalars.R=(this.axes.outer.length?this.axes.outer:this.axes.total).map(v.prefix),this.indices={},this.indices.A=v.index("AIndex",this.scalars.A,this.strides.A,this.tensors.A.offset),this.indices.R=v.index("RIndex",this.scalars.R,this.strides.R,this.tensors.R.offset),this.variables={},this.variables.T=w.variable({symbol:"temp",index:"0",size:this.tensors.R.type.size}),this.variables.A=w.variable({symbol:"this.tensors.A.data",index:"AIndex",size:this.tensors.A.type.size}),this.variables.R=w.variable({symbol:"this.tensors.R.data",index:"RIndex",size:this.tensors.R.type.size})}resultant(){return b.zeros({type:this.tensors.A.type,shape:this.tensors.A.shape.filter(function(t,e){return!this.axes.inner.includes(e)},this)})}}class I extends A{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),this.indices.A,this.indices.R,w.assign(this.variables.R,w.cos(this.variables.A)),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class R extends A{constructor(t){super({...t,axes:t.axes||[...t.of.shape.keys()]}),this.invoke=new Function([`const temp = new Array(${this.tensors.A.type.size}).fill(0)`,this.loops.outer.join("\n"),this.indices.R,"temp.fill(Number.NEGATIVE_INFINITY)",this.loops.inner.join("\n"),this.indices.A,w.if(w.greaterThan(this.variables.A,this.variables.T).slice(0,1),w.assign(this.variables.T,this.variables.A)),"}".repeat(this.loops.inner.length),w.assign(this.variables.R,this.variables.T),"}".repeat(this.loops.outer.length),"return this.tensors.R"].join("\n"))}}class T extends A{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),this.indices.A,this.indices.R,w.assign(this.variables.R,w.sin(this.variables.A)),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class z extends A{constructor(t){super({...t,axes:t.axes||[...t.of.shape.keys()]}),this.invoke=new Function([`const temp = new Array(${this.tensors.A.type.size}).fill(0)`,this.loops.outer.join("\n"),this.indices.R,this.loops.inner.join("\n"),this.indices.A,w.assign(this.variables.T,this.variables.A,"+="),"}".repeat(this.loops.inner.length),w.assign(this.variables.R,this.variables.T),"temp.fill(0)","}".repeat(this.loops.outer.length),"return this.tensors.R"].join("\n"))}}class O extends A{constructor(t){super({...t,axes:t.axes||[...t.of.shape.keys()]}),this.invoke=new Function([`const temp = new Array(${this.tensors.A.type.size}).fill(0)`,this.loops.outer.join("\n"),this.indices.R,"temp.fill(Number.POSITIVE_INFINITY)",this.loops.inner.join("\n"),this.indices.A,w.if(w.lessThan(this.variables.A,this.variables.T).slice(0,1),w.assign(this.variables.T,this.variables.A)),"}".repeat(this.loops.inner.length),w.assign(this.variables.R,this.variables.T),"}".repeat(this.loops.outer.length),"return this.tensors.R"].join("\n"))}}class N extends A{constructor(t){super({...t,axes:t.axes||[...t.of.shape.keys()]}),this.invoke=new Function([`const temp = new Array(${this.tensors.A.type.size}).fill(0)`,this.loops.outer.join("\n"),this.indices.R,this.loops.inner.join("\n"),this.indices.A,w.assign(this.variables.T,this.variables.A,"+="),"}".repeat(this.loops.inner.length),w.assign(this.variables.R,w.scale(this.variables.T,1/this.dimensions.inner)),"temp.fill(0)","}".repeat(this.loops.outer.length),"return this.tensors.R"].join("\n"))}}class E extends A{constructor(t){super({...t,axes:t.axes||[...t.of.shape.keys()],result:t.result||b.zeros({type:g.Float32,shape:[]})}),this.invoke=new Function([`const temp = new Array(${this.tensors.A.type.size}).fill(0)`,this.loops.outer.join("\n"),this.indices.R,this.loops.inner.join("\n"),this.indices.A,w.assign(this.variables.T.slice(0,1),w.sum(w.square(this.variables.A)),"+=").slice(0,1),"}".repeat(this.loops.inner.length),w.assign(this.variables.R,w.squareRoot(this.variables.T)),"temp.fill(0)","}".repeat(this.loops.outer.length),"return this.tensors.R"].join("\n"))}}class _{constructor(t){this.tensors={},this.tensors.A=b.tensor({data:t.of}),this.tensors.B=b.tensor({data:t.with}),this.tensors.R=t.result||this.resultant(),this.axes={},this.axes.total=[...new Array(y.max(this.tensors.A.shape.length,this.tensors.B.shape.length)).keys()],this.axes.R=this.axes.total,this.axes.A=this.axes.total.slice().reverse().filter(x.nonZeroAxes,this.tensors.A).reverse(),this.axes.B=this.axes.total.slice().reverse().filter(x.nonZeroAxes,this.tensors.B).reverse(),this.loops={},this.loops.total=v.loopAxes(this.axes.total,this.tensors.R),this.strides={},this.strides.A=this.tensors.A.strides,this.strides.B=this.tensors.B.strides,this.strides.R=this.tensors.R.strides,this.scalars={},this.scalars.A=this.axes.total.map(function(t){return this.axes.A.includes(t)?v.prefix(t):0},this),this.scalars.B=this.axes.total.map(function(t){return this.axes.B.includes(t)?v.prefix(t):0},this),this.scalars.R=this.axes.total.map(function(t){return this.axes.R.includes(t)?v.prefix(t):0},this),this.indices={},this.indices.A=v.index("AIndex",this.scalars.A,this.strides.A,this.tensors.A.offset),this.indices.B=v.index("BIndex",this.scalars.B,this.strides.B,this.tensors.B.offset),this.indices.R=v.index("RIndex",this.scalars.R,this.strides.R,this.tensors.R.offset),this.variables={},this.variables.A=w.variable({symbol:"this.tensors.A.data",index:"AIndex",size:this.tensors.A.type.size}),this.variables.B=w.variable({symbol:"this.tensors.B.data",index:"BIndex",size:this.tensors.B.type.size}),this.variables.R=w.variable({symbol:"this.tensors.R.data",index:"RIndex",size:this.tensors.R.type.size})}resultant(){const t=y.max(this.tensors.A.shape.length,this.tensors.B.shape.length),e=[];for(let s=0;s<t;s++){const t=this.tensors.B.shape.length-1-s,i=this.tensors.A.shape.length-1-s;1===this.tensors.B.shape[t]||void 0===this.tensors.B.shape[t]?e.push(this.tensors.A.shape[i]):1===this.tensors.A.shape[i]||void 0===this.tensors.A.shape[i]?e.push(this.tensors.B.shape[t]):this.tensors.B.shape[t]===this.tensors.A.shape[i]&&e.push(this.tensors.A.shape[i])}return b.zeros({shape:e.reverse(),type:this.tensors.A.type})}}class S extends _{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),Object.values(this.indices).join("\n"),w.divide(this.variables.R,this.variables.A,this.variables.B),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class F extends A{constructor(t){super(t),this.norm=new E({of:this.tensors.A}),this.division=new S({of:this.tensors.A,with:this.norm.invoke()}),this.invoke=this.division.invoke}}class j extends A{constructor(t){super(t),this.count=t.count||1,this.axes.order=this.axes.outer.concat(this.axes.inner),this.axes.last=this.axes.order[this.axes.order.length-1],this.axes.repeat=this.axes.inner[0]||this.axes.last,this.tensors.R=t.result||this.resultant(),this.loops.count=v.loop([`let r = i${this.axes.last}*${this.count}, c = 0`],[`c < ${this.count}`],["r++, c++"]),this.scalars.R=this.axes.total.map(v.prefix),this.scalars.R[this.axes.repeat]="r",this.indices.R=v.index("RIndex",this.scalars.R,this.strides.R,this.tensors.R.offset),this.invoke=new Function([...this.loops.outer,...this.loops.inner,this.indices.A,this.loops.count,this.indices.R,w.assign(this.variables.R,this.variables.A),"}","}".repeat(this.loops.inner.length),"}".repeat(this.loops.outer.length),"return this.tensors.R"].join("\n")).bind(this)}resultant(){return b.zeros({type:this.tensors.A.type,shape:this.tensors.A.shape.map(function(t,e){return e===this.axes.repeat?this.count*t:t},this)})}}class M extends A{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),this.indices.A,this.indices.R,w.assign(this.variables.R,w.negate(this.variables.A)),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class P extends A{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),this.indices.A,this.indices.R,w.assign(this.variables.R,w.exp(this.variables.A)),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class B extends _{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),Object.values(this.indices).join("\n"),w.assign(this.variables.R,w.add(this.variables.A,this.variables.B)),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class C extends _{constructor(t){const e=t.of.slice({region:t.region||[]});super({...t,of:e,result:e}),this.tensors.original=t.of,this.invoke=new Function([this.loops.total.join("\n"),Object.values(this.indices).join("\n"),w.assign(this.variables.A,this.variables.B),"}".repeat(this.axes.total.length),"return this.tensors.original"].join("\n")).bind(this)}}class k extends _{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),Object.values(this.indices).join("\n"),w.assign(this.variables.R,w.subtract(this.variables.A,this.variables.B)),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class U extends _{constructor(t){super(t),this.invoke=new Function([this.loops.total.join("\n"),Object.values(this.indices).join("\n"),w.assign(this.variables.R,w.multiply(this.variables.A,this.variables.B)),"}".repeat(this.axes.total.length),"return this.tensors.R"].join("\n")).bind(this)}}class ${constructor(t){this.tensors={},this.tensors.A=b.tensor({data:t.of}),this.tensors.B=b.tensor({data:t.with}),this.tensors.R=t.result||this.resultant(),this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.invoke=new Function(this.pointwise.source.join("\n")).bind(this)}resultant(){return b.zeros({shape:[3,1],type:this.tensors.A.type})}pointwiseSource(){const t=[],e=[],s=[];for(let i=0;i<3;i++)t.push(w.variable({symbol:"this.tensors.A.data",index:this.tensors.A.header.flatIndex([i,0]),size:this.tensors.A.type.size})),e.push(w.variable({symbol:"this.tensors.B.data",index:this.tensors.B.header.flatIndex([i,0]),size:this.tensors.B.type.size})),s.push(w.variable({symbol:"this.tensors.R.data",index:this.tensors.R.header.flatIndex([i,0]),size:this.tensors.R.type.size}));return[w.assign(s[0],w.add(w.negate(w.multiply(t[2],e[1])),w.multiply(e[2],t[1]))),w.assign(s[1],w.add(w.negate(w.multiply(t[0],e[2])),w.multiply(e[0],t[2]))),w.assign(s[2],w.subtract(w.multiply(t[0],e[1]),w.multiply(e[0],t[1]))),"return this.tensors.R"]}}const D=function(t){const e=[];for(let s=0;s<t;s++)for(let i=0;i<t;i++)e.push([s,i]);return e};class V{constructor(t){this.tensors={},this.tensors.A=b.tensor({data:t.of}),this.tensors.R=t.result||this.resultant(),this.rows=this.tensors.A.shape[0],this.cols=this.tensors.A.shape[1],this.size=this.rows,this.matrixTemplate=D(this.size),this.pointwise={},this.pointwise.source=this.pointwiseSource(this.matrixTemplate),this.invoke=new Function([this.pointwise.source,"return R"].join("\n"))}static fromAdjugate(t){return w.assign(w.variable({symbol:"determinant",size:t.tensors.A.type.size,index:0}),new Array(t.size).fill(null).map(function(e,s){return w.multiply(w.variable({symbol:"this.tensors.A.data",size:t.tensors.A.type.size,index:t.tensors.A.header.flatIndex([0,s])}),w.variable({symbol:"this.tensors.R.data",size:t.tensors.A.type.size,index:t.tensors.R.header.flatIndex([s,0])}))}).reduce(w.add))}resultant(){return b.zeros({shape:[1,1],type:this.tensors.A.type.size})}pointwiseSource(t){if(1===t.length)return w.variable({symbol:"this.tensors.A.data",size:this.tensors.A.type.size,index:this.tensors.A.header.flatIndex(t[0])});const e=[],s=Math.sqrt(t.length);for(let i=0;i<s;i++){const s=V.minor(t,0,i),n=this.pointwiseSource(s),r=w.variable({symbol:"this.tensors.A.data",size:this.tensors.A.type.size,index:this.tensors.A.header.flatIndex(t[i])}),o=w.multiply(r,n);e.push(Math.pow(-1,i%2)>0?o:w.negate(o))}return e.reduce(w.add)}static minor(t,e,s){const i=Math.sqrt(t.length);return t.filter(function(t,n){return n%i!==s&&Math.floor(n/i)!==e})}}class L{constructor(t){this.tensors={},this.tensors.A=b.tensor({data:t.of}),this.tensors.R=t.result||this.resultant(),this.size=this.tensors.A.shape[0],this.determinant=new V(t),this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.invoke=new Function([this.pointwise.source.join("\n"),"return this.tensors.R"].join("\n")).bind(this)}resultant(){return b.zeros({shape:this.tensors.A.shape,type:this.tensors.A.type})}pointwiseSource(){const t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){const i=Math.pow(-1,(e+s)%2),n=V.minor(D(this.size),s,e),r=this.determinant.pointwiseSource(n),o=i<0?w.negate(r):r;t.push(w.assign(w.variable({index:this.tensors.R.header.flatIndex([e,s]),symbol:"this.tensors.R.data",size:this.tensors.R.type.size}),o))}return t}}class Y{constructor(t){this.tensors={},this.tensors.A=b.tensor({data:t.of}),this.tensors.R=t.result||this.resultant(),this.rows=this.tensors.A.shape[0],this.cols=this.tensors.A.shape[1],this.size=this.rows,this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.invoke=new Function(`\n            const temp = new Array(${this.tensors.A.type.size})\n            const determinant = new Array(${this.tensors.A.type.size})\n            ${this.pointwise.source.join("\n")};\n            return this.tensors.R`).bind(this)}resultant(){return b.zeros({shape:this.tensors.A.shape,type:this.tensors.A.type})}pointwiseSource(){this.adjugate=new L({of:this.tensors.A,result:this.tensors.R}),this.determinant=V.fromAdjugate(this.adjugate);const t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){const i=w.variable({symbol:"determinant",size:this.tensors.A.type.size,index:0}),n=w.variable({index:this.tensors.R.header.flatIndex([e,s]),symbol:"this.tensors.R.data",size:this.tensors.R.type.size}),r=w.variable({symbol:"temp",size:this.tensors.A.type.size,index:0});t.push(w.divide(r,n,i)),t.push(w.assign(n,r))}return[this.adjugate.pointwise.source,this.determinant,t].flat(Number.POSITIVE_INFINITY)}}class G{constructor(t){if(this.tensors={},this.tensors.A=b.tensor({data:t.of}),this.tensors.B=b.tensor({data:t.with}),this.tensors.R=t.result||this.resultant(),this.rows=this.tensors.A.shape[0],this.cols=this.tensors.B.shape[1],this.like=this.tensors.A.shape[1],this.like>50)return this.indices={},this.indices.A="const AIndex = r * this.tensors.A.strides[0] + s * this.tensors.A.strides[1] + this.tensors.A.offset",this.indices.B="const BIndex = r * this.tensors.B.strides[0] + s * this.tensors.B.strides[1] + this.tensors.B.offset",this.indices.R="const RIndex = r * this.tensors.R.strides[0] + c * this.tensors.R.strides[1] + this.tensors.R.offset",this.variables={},this.variables.A=w.variable({symbol:"this.tensors.A.data",size:this.tensors.A.type.size,index:"AIndex"}),this.variables.B=w.variable({symbol:"this.tensors.B.data",size:this.tensors.B.type.size,index:"BIndex"}),this.variables.R=w.variable({symbol:"this.tensors.R.data",size:this.tensors.R.type.size,index:"RIndex"}),this.symbolic={},this.symbolic.source=this.symbolicSource(),void(this.invoke=new Function(`${this.symbolic.source}; return this.tensors.R`).bind(this));this.pointwise={},this.pointwise.source=this.pointwiseSource(),this.invoke=new Function(`${this.pointwise.source}; return this.tensors.R`).bind(this)}resultant(){return b.zeros({type:this.tensors.A.type,shape:[this.tensors.A.shape[0],this.tensors.B.shape[1]]})}symbolicSource(){return["for (let r = 0; r < this.tensors.A.shape[0]; r++){","for (let c = 0; c < this.tensors.B.shape[1]; c++){",this.indices.R,"this.tensors.R.data[RIndex] = 0","for (let s = 0; s < this.tensors.A.shape[1]; s++) {",this.indices.A,this.indices.B,w.assign(this.variables.R,w.multiply(this.variables.A,this.variables.B),"+="),"}}}"].join("\n")}pointwiseSource(){const t=[];for(let e=0;e<this.rows;e++)for(let s=0;s<this.cols;s++)t.push(w.assign(w.variable({symbol:"this.tensors.R.data",size:this.tensors.R.type.size,index:this.tensors.R.header.flatIndex([e,s])}),new Array(this.like).fill(null).map(function(t,i){return w.multiply(w.variable({symbol:"this.tensors.A.data",size:this.tensors.A.type.size,index:this.tensors.A.header.flatIndex([e,i])}),w.variable({symbol:"this.tensors.B.data",size:this.tensors.B.type.size,index:this.tensors.B.header.flatIndex([i,s])}))},this).reduce(w.add)));return t.flat(Number.POSITIVE_INFINITY).join("\n")}}var H={...r,...i,...n};Object.assign(b,g),Object.assign(b,H);var q=b;class X{constructor(t){this.context=t.context,this.mapType=this.mapType.bind(this),this.createBuffer=this.createBuffer.bind(this)}createBuffer({array:t}){const e=this.context.createBuffer(),s=this.mapType({array:t}),i=this.context.STATIC_DRAW,n=this.context.ARRAY_BUFFER;return this.context.bindBuffer(n,e),this.context.bufferData(n,t.data,i),{buffer:e,size:t.shape[1],count:t.shape[0],type:s,normalize:!1,offset:t.offset*t.data.BYTES_PER_ELEMENT,stride:t.strides[0]*t.data.BYTES_PER_ELEMENT}}mapType({array:t}){return t.type.typed===Int8Array?this.context.BYTE:t.type.typed===Uint8Array?this.context.UNSIGNED_BYTE:t.type.typed===Uint8ClampedArray?this.context.UNSIGNED_BYTE:t.type.typed===Int16Array?this.context.SHORT:t.type.typed===Uint16Array?this.context.UNSIGNED_SHORT:t.type.typed===Int32Array?this.context.INT:t.type.typed===Uint32Array?this.context.UNSIGNED_INT:t.type.typed===Float32Array?this.context.FLOAT:null}}var J={CONTEXT_2D:"2d",CONTEXT_WEB_GL:"webgl",HUD_FONT:"18px serif",HUD_COLOR:"rgba(255, 255, 255, 1)",HUD_TEXT_LOCATION:[10,50],CANVAS_STROKE_COLOR:"white",CANVAS_FILL_COLOR:"rgba(255, 165, 0, 1)",BINDINGS:{o:{name:"zoom",args:[!0]},i:{name:"zoom",args:[!1]},ArrowUp:{name:"pan",args:[0]},ArrowDown:{name:"pan",args:[1]},ArrowLeft:{name:"pan",args:[2]},ArrowRight:{name:"pan",args:[3]}},VERTEX_SOURCE:"attribute float a_PointSize;\nattribute vec4 a_Position;\nattribute vec4 a_Color;\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjMatrix;\nvarying vec4 v_Color;\nvoid main() {\n  gl_PointSize = a_PointSize;\n  gl_Position = u_ProjMatrix * u_ViewMatrix * a_Position;\n  v_Color = a_Color;\n}\n",FRAGMENT_SOURCE:"precision mediump float;\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n",TO_VECTOR:q.tensor({data:[[0],[0],[0],[1]],type:q.Float32}),UP_VECTOR:q.tensor({data:[[0],[1],[0],[1]],type:q.Float32}),FROM_VECTOR:q.tensor({data:[[5],[5],[5],[1]],type:q.Float32}),VIEWING_ANGLE:30,ASPECT_RATIO:1,NEAR:1e-6,FAR:1e6,ZOOM_DELTA:.02,PAN_DELTA:Math.PI/128,ACTIVE_VERTICES:0,UP_DIRECTION:0,DOWN_DIRECTION:1,LEFT_DIRECTION:2,RIGHT_DIRECTION:3};class Q{constructor(){this.config=J,this.UP=this.config.UP_VECTOR,this.TO=this.config.TO_VECTOR,this.FROM=this.config.FROM_VECTOR;const t=Math.sin(this.config.PAN_DELTA),e=Math.cos(this.config.PAN_DELTA);this.upRot=q.tensor({data:[[1,0,0,0],[0,e,-t,0],[0,t,e,0],[0,0,0,1]],type:q.Float32}),this.downRot=q.tensor({data:[[1,0,0,0],[0,e,t,0],[0,-t,e,0],[0,0,0,1]],type:q.Float32}),this.leftRot=q.tensor({data:[[e,0,t,0],[0,1,0,0],[-t,0,e,0],[0,0,0,1]],type:q.Float32}),this.rightRot=q.tensor({data:[[e,0,-t,0],[0,1,0,0],[t,0,e,0],[0,0,0,1]],type:q.Float32})}lookAt(){return this.viewMatrix=q.eye({shape:[4,4],type:q.Float32}),this.transMatrix=q.eye({shape:[4,4],type:q.Float32}),this.f=this.FROM.subtract({with:this.TO}),this.s=this.UP.cross({with:this.f}),this.uf=this.f.divide({with:this.f.norm()}),this.us=this.s.divide({with:this.s.norm()}),this.uu=this.uf.cross({with:this.us}),this.viewMatrix.slice({region:[":3","0:1"]}).assign({with:this.us}),this.viewMatrix.slice({region:[":3","1:2"]}).assign({with:this.uu}),this.viewMatrix.slice({region:[":3","2:3"]}).assign({with:this.uf}),this.transMatrix.slice({region:["3:4",":3"]}).assign({with:this.FROM.negate().T()}),this.transMatrix.matMult({with:this.viewMatrix})}project(){const t=Math.PI*this.config.VIEWING_ANGLE/180/2,e=1/(this.config.FAR-this.config.NEAR),s=Math.sin(t),i=Math.cos(t)/s,n=new Float32Array(16);return n[0]=i/this.config.ASPECT_RATIO,n[5]=i,n[10]=-(this.config.FAR+this.config.NEAR)*e,n[11]=-1,n[14]=-2*this.config.NEAR*this.config.FAR*e,q.tensor({data:n,type:q.Float32}).reshape({shape:[4,4]})}rotate({orientation:t,viewMatrix:e,viewMatrixInv:s}){s.T().matMult({with:t}).matMult({with:e.T()}).matMult({with:this.TO,result:this.TO})}pan(t){const e=this.lookAt(),s=e.inverse();switch(t){case this.config.UP_DIRECTION:return this.rotate({orientation:this.upRot,viewMatrix:e,viewMatrixInv:s});case this.config.DOWN_DIRECTION:return this.rotate({orientation:this.downRot,viewMatrix:e,viewMatrixInv:s});case this.config.LEFT_DIRECTION:return this.rotate({orientation:this.leftRot,viewMatrix:e,viewMatrixInv:s});case this.config.RIGHT_DIRECTION:return this.rotate({orientation:this.rightRot,viewMatrix:e,viewMatrixInv:s})}}zoom(t){const e=t?"add":"subtract",s=this.FROM.subtract({with:this.TO}).multiply({with:this.config.ZOOM_DELTA});this.TO[e]({with:s,result:this.TO}),this.FROM[e]({with:s,result:this.FROM})}}class W{constructor(t){this.config=J,this.context=t.context,this.vertexShader=this.createShader({type:this.context.VERTEX_SHADER,source:J.VERTEX_SOURCE}),this.fragmentShader=this.createShader({type:this.context.FRAGMENT_SHADER,source:J.FRAGMENT_SOURCE}),this.program=this.createProgram()}createShader({type:t,source:e}){const s=this.context.createShader(t);return this.context.shaderSource(s,e),this.context.compileShader(s),this.context.getShaderParameter(s,this.context.COMPILE_STATUS)?s:(console.error(`Error with compile: ${this.context.getShaderInfoLog(s)}`),this.context.deleteShader(s),null)}createProgram(){const t=this.context.createProgram();return this.context.attachShader(t,this.vertexShader),this.context.attachShader(t,this.fragmentShader),this.context.linkProgram(t),this.context.getProgramParameter(t,this.context.LINK_STATUS)?t:(console.error(`Error with link: ${this.context.getProgramInfoLog(t)}`),this.context.deleteProgram(t),null)}}class Z{constructor(t){this.context=t.context,this.program=t.program,this.uniforms=this.createUniforms()}createUniforms(){const t={},e=this.context.getProgramParameter(this.program,this.context.ACTIVE_UNIFORMS);for(let s=0;s<e;s++){const e=this.context.getActiveUniform(this.program,s),i=this.context.getUniformLocation(this.program,e.name);t[e.name]=this.createUniform({type:e.type,location:i})}return t}createUniform({type:t,location:e}){return t===this.context.FLOAT_MAT2?function(t){this.context.uniformMatrix2fv(e,!1,t.data)}.bind(this):t===this.context.FLOAT_MAT3?function(t){this.context.uniformMatrix3fv(e,!1,t.data)}.bind(this):t===this.context.FLOAT_MAT4?function(t){this.context.uniformMatrix4fv(e,!1,t.data)}.bind(this):void 0}}class K{constructor(t){this.program=t.program,this.context=t.context,this.attributes=this.createAttributes()}createAttributes(){const t={},e=this.context.getProgramParameter(this.program,this.context.ACTIVE_ATTRIBUTES);for(var s=0;s<e;s++){const e=this.context.getActiveAttrib(this.program,s),i=this.context.getAttribLocation(this.program,e.name);t[e.name]=this.createAttribute({location:i})}return t}createAttribute({location:t}){return function(e){this.context.bindBuffer(this.context.ARRAY_BUFFER,e.buffer),this.context.enableVertexAttribArray(t),this.context.vertexAttribPointer(t,e.size,e.type,e.normalize,e.stride,e.offset)}.bind(this)}}class tt{constructor(){this.config=J,this.objects=[],this.pan=this.pan.bind(this),this.zoom=this.zoom.bind(this),this.plot=this.plot.bind(this),this.start=this.start.bind(this),this.render=this.render.bind(this),this.start()}start(){return this.hud=document.createElement("canvas"),this.hud.style.zIndex=this.config.HUD_Z_INDEX,this.hud.style.position=this.config.HUD_POSITION_STYLE,this.canvas=document.createElement("canvas"),this.canvas.style.zIndex=this.config.CANVAS_Z_INDEX,this.canvas.style.position=this.config.CANVAS_POSITION_STYLE,this.resize(),this.canvas.context=this.canvas.getContext(this.config.CONTEXT_WEB_GL),this.cameraManager=new Q({}),this.bufferManager=new X({context:this.canvas.context}),this.programManager=new W({context:this.canvas.context}),this.uniformManager=new Z({context:this.canvas.context,program:this.programManager.program}),this.attributeManager=new K({context:this.canvas.context,program:this.programManager.program}),this.canvas.context.useProgram(this.programManager.program),this.hud.context=this.hud.getContext(this.config.CONTEXT_2D),this.hud.context.font=this.config.HUD_FONT,this.hud.context.fillStyle=this.config.HUD_COLOR,document.body.prepend(this.hud),document.body.prepend(this.canvas),this}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.hud.width=.5*window.innerWidth,this.hud.height=.2*window.innerHeight,this.config.ASPECT_RATIO=this.canvas.width/this.canvas.height}plot({vertices:t,colors:e,sizes:s,mode:i}){this.objects.push({sizeBuffer:this.bufferManager.createBuffer({array:s}),colorBuffer:this.bufferManager.createBuffer({array:e}),vertexBuffer:this.bufferManager.createBuffer({array:t}),drawMode:this.canvas.context[i],drawCount:t.shape[0]}),this.render()}render(){this.canvas.context.clear(this.canvas.context.COLOR_BUFFER_BIT);for(const t of this.objects)this.attributeManager.attributes.a_Color(t.colorBuffer),this.attributeManager.attributes.a_PointSize(t.sizeBuffer),this.attributeManager.attributes.a_Position(t.vertexBuffer),this.uniformManager.uniforms.u_ViewMatrix(this.cameraManager.lookAt()),this.uniformManager.uniforms.u_ProjMatrix(this.cameraManager.project()),this.canvas.context.drawArrays(t.drawMode,0,t.drawCount)}pan(t){this.cameraManager.pan(t),this.render()}zoom(t){this.cameraManager.zoom(t),this.hud.context.clearRect(0,0,this.hud.width,this.hud.height),this.hud.context.fillText(`loc | r: ${Math.round(this.config.FROM_VECTOR.data[0])} g: ${Math.round(this.config.FROM_VECTOR.data[1])}, b: ${Math.round(this.config.FROM_VECTOR.data[2])}`,10,70),this.render()}}class et{constructor(t){this.isPressed=t.isPressed||!1,this.position=t.position||{x:0,y:0}}mouseup(){this.isPressed=!1}mousedown(t){this.isPressed=!0,this.position.x=t.clientX,this.position.y=t.clientY}mousemove(t){this.position.x=t.clientX,this.position.y=t.clientY}}class st{constructor(t){this.keys=t.keys||new Set,this.bindings=t.bindings}keyup(){this.keys.clear()}keydown(t){this.keys.add(t.key);const e=Array.from(this.keys).sort().join("|");return this.bindings[e]}}var it=new class{constructor(){this.config=J,this.keyup=this.keyup.bind(this),this.resize=this.resize.bind(this),this.keydown=this.keydown.bind(this),this.mouseup=this.mouseup.bind(this),this.mousedown=this.mousedown.bind(this),this.mousemove=this.mousemove.bind(this),this.mouse=new et({location:{x:0,y:0}}),this.keyboard=new st({bindings:this.config.BINDINGS}),this.graphics=new tt({}),window.addEventListener("resize",this.resize),window.addEventListener("keyup",this.keyup),window.addEventListener("keydown",this.keydown),window.addEventListener("mouseup",this.mouseup),window.addEventListener("mousedown",this.mousedown),window.addEventListener("mousemove",this.mousemove)}mouseup(){this.mouse.mouseup()}mousedown(t){this.mouse.mousedown(t)}mousemove(t){this.mouse.mousemove(t)}keyup(){this.keyboard.keyup()}keydown(t){const e=this.keyboard.keydown(t);if(e){t.preventDefault(),(0,this.graphics[e.name])(...e.args)}}resize(){this.graphics.resize()}};window.bb=q,window.myio=class{static async imread(t){const e=document.createElement("canvas"),s=e.getContext("2d"),i=await fetch(t),n=await i.blob(),r=await createImageBitmap(n),o=[0,0,r.width,r.height];e.width=r.width,e.height=r.height,s.drawImage(r,...o),e.remove();let a=s.getImageData(...o).data;const h=new Uint8ClampedArray(r.width*r.height*3);for(let t=0,e=0;t<a.length;t+=4,e+=3)h[e]=a[t],h[e+1]=a[t+1],h[e+2]=a[t+2];return a=null,{shape:[r.width,r.height,3],pixels:h,binary:r}}},window.app=it;e.default=async function(){}()}]);
//# sourceMappingURL=main.js.map