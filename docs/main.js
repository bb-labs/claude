!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e,s){(function(t){var i=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),s={},i=0;i<e.length;i++)s[e[i]]=Object.getOwnPropertyDescriptor(t,e[i]);return s},r=/%[sdj%]/g;e.format=function(t){if(!w(t)){for(var e=[],s=0;s<arguments.length;s++)e.push(a(arguments[s]));return e.join(" ")}s=1;for(var i=arguments,n=i.length,o=String(t).replace(r,function(t){if("%%"===t)return"%";if(s>=n)return t;switch(t){case"%s":return String(i[s++]);case"%d":return Number(i[s++]);case"%j":try{return JSON.stringify(i[s++])}catch(t){return"[Circular]"}default:return t}}),h=i[s];s<n;h=i[++s])m(h)||!v(h)?o+=" "+h:o+=" "+a(h);return o},e.deprecate=function(s,i){if(void 0!==t&&!0===t.noDeprecation)return s;if(void 0===t)return function(){return e.deprecate(s,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),r=!0}return s.apply(this,arguments)}};var n,o={};function a(t,s){var i={seen:[],stylize:u};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),f(s)?i.showHidden=s:s&&e._extend(i,s),b(i.showHidden)&&(i.showHidden=!1),b(i.depth)&&(i.depth=2),b(i.colors)&&(i.colors=!1),b(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=h),l(i,t,i.depth)}function h(t,e){var s=a.styles[e];return s?"["+a.colors[s][0]+"m"+t+"["+a.colors[s][1]+"m":t}function u(t,e){return t}function l(t,s,i){if(t.customInspect&&s&&I(s.inspect)&&s.inspect!==e.inspect&&(!s.constructor||s.constructor.prototype!==s)){var r=s.inspect(i,t);return w(r)||(r=l(t,r,i)),r}var n=function(t,e){if(b(e))return t.stylize("undefined","undefined");if(w(e)){var s="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(s,"string")}if(y(e))return t.stylize(""+e,"number");if(f(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,s);if(n)return n;var o=Object.keys(s),a=function(t){var e={};return t.forEach(function(t,s){e[t]=!0}),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(s)),x(s)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return c(s);if(0===o.length){if(I(s)){var h=s.name?": "+s.name:"";return t.stylize("[Function"+h+"]","special")}if(g(s))return t.stylize(RegExp.prototype.toString.call(s),"regexp");if(T(s))return t.stylize(Date.prototype.toString.call(s),"date");if(x(s))return c(s)}var u,v="",A=!1,O=["{","}"];(d(s)&&(A=!0,O=["[","]"]),I(s))&&(v=" [Function"+(s.name?": "+s.name:"")+"]");return g(s)&&(v=" "+RegExp.prototype.toString.call(s)),T(s)&&(v=" "+Date.prototype.toUTCString.call(s)),x(s)&&(v=" "+c(s)),0!==o.length||A&&0!=s.length?i<0?g(s)?t.stylize(RegExp.prototype.toString.call(s),"regexp"):t.stylize("[Object]","special"):(t.seen.push(s),u=A?function(t,e,s,i,r){for(var n=[],o=0,a=e.length;o<a;++o)E(e,String(o))?n.push(p(t,e,s,i,String(o),!0)):n.push("");return r.forEach(function(r){r.match(/^\d+$/)||n.push(p(t,e,s,i,r,!0))}),n}(t,s,i,a,o):o.map(function(e){return p(t,s,i,a,e,A)}),t.seen.pop(),function(t,e,s){if(t.reduce(function(t,e){return 0,e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return s[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+s[1];return s[0]+e+" "+t.join(", ")+" "+s[1]}(u,v,O)):O[0]+v+O[1]}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,s,i,r,n){var o,a,h;if((h=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]}).get?a=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(a=t.stylize("[Setter]","special")),E(i,r)||(o="["+r+"]"),a||(t.seen.indexOf(h.value)<0?(a=m(s)?l(t,h.value,null):l(t,h.value,s-1)).indexOf("\n")>-1&&(a=n?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),b(o)){if(n&&r.match(/^\d+$/))return a;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function d(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function m(t){return null===t}function y(t){return"number"==typeof t}function w(t){return"string"==typeof t}function b(t){return void 0===t}function g(t){return v(t)&&"[object RegExp]"===A(t)}function v(t){return"object"==typeof t&&null!==t}function T(t){return v(t)&&"[object Date]"===A(t)}function x(t){return v(t)&&("[object Error]"===A(t)||t instanceof Error)}function I(t){return"function"==typeof t}function A(t){return Object.prototype.toString.call(t)}function O(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(s){if(b(n)&&(n=t.env.NODE_DEBUG||""),s=s.toUpperCase(),!o[s])if(new RegExp("\\b"+s+"\\b","i").test(n)){var i=t.pid;o[s]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",s,i,t)}}else o[s]=function(){};return o[s]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=f,e.isNull=m,e.isNullOrUndefined=function(t){return null==t},e.isNumber=y,e.isString=w,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=b,e.isRegExp=g,e.isObject=v,e.isDate=T,e.isError=x,e.isFunction=I,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=s(2);var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function S(){var t=new Date,e=[O(t.getHours()),O(t.getMinutes()),O(t.getSeconds())].join(":");return[t.getDate(),N[t.getMonth()],e].join(" ")}function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",S(),e.format.apply(e,arguments))},e.inherits=s(3),e._extend=function(t,e){if(!e||!v(e))return t;for(var s=Object.keys(e),i=s.length;i--;)t[s[i]]=e[s[i]];return t};var z="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function R(t,e){if(!t){var s=new Error("Promise was rejected with a falsy value");s.reason=t,t=s}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(z&&t[z]){var e;if("function"!=typeof(e=t[z]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,z,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,s,i=new Promise(function(t,i){e=t,s=i}),r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);r.push(function(t,i){t?s(t):e(i)});try{t.apply(this,r)}catch(t){s(t)}return i}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),z&&Object.defineProperty(e,z,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,i(t))},e.promisify.custom=z,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function s(){for(var s=[],i=0;i<arguments.length;i++)s.push(arguments[i]);var r=s.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var n=this,o=function(){return r.apply(n,arguments)};e.apply(this,s).then(function(e){t.nextTick(o,null,e)},function(e){t.nextTick(R,e,o)})}return Object.setPrototypeOf(s,Object.getPrototypeOf(e)),Object.defineProperties(s,i(e)),s}}).call(this,s(1))},function(t,e){var s,i,r=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(s===setTimeout)return setTimeout(t,0);if((s===n||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:n}catch(t){s=n}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var h,u=[],l=!1,c=-1;function p(){l&&h&&(l=!1,h.length?u=h.concat(u):c=-1,u.length&&d())}function d(){if(!l){var t=a(p);l=!0;for(var e=u.length;e;){for(h=u,u=[];++c<e;)h&&h[c].run();c=-1,e=u.length}h=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)e[s-1]=arguments[s];u.push(new f(t,e)),1!==u.length||l||a(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var s=function(){};s.prototype=e.prototype,t.prototype=new s,t.prototype.constructor=t}},function(t,e,s){"use strict";s.r(e);var i={};s.r(i),s.d(i,"exp",function(){return N}),s.d(i,"cos",function(){return S}),s.d(i,"max",function(){return E}),s.d(i,"sin",function(){return z}),s.d(i,"sum",function(){return R}),s.d(i,"min",function(){return k}),s.d(i,"mean",function(){return F}),s.d(i,"norm",function(){return C}),s.d(i,"unit",function(){return L}),s.d(i,"negate",function(){return B}),s.d(i,"repeat",function(){return P}),s.d(i,"insert",function(){return M}),s.d(i,"square",function(){return X});var r={};s.r(r),s.d(r,"add",function(){return $}),s.d(r,"assign",function(){return U}),s.d(r,"divide",function(){return j}),s.d(r,"subtract",function(){return V}),s.d(r,"multiply",function(){return D});var n={};s.r(n),s.d(n,"cross",function(){return G}),s.d(n,"inverse",function(){return q}),s.d(n,"matMult",function(){return W}),s.d(n,"adjugate",function(){return J}),s.d(n,"determinant",function(){return Z});var o={};s.r(o),s.d(o,"mesh",function(){return Q});class a{static async audioread(t){const e=new AudioContext,s=await fetch(t),i=await s.arrayBuffer();return(await e.decodeAudioData(i)).getChannelData(0)}static async imread(t){const e=document.createElement("canvas"),s=e.getContext("2d"),i=await fetch(t),r=await i.blob(),n=await createImageBitmap(r),o=[0,0,n.width,n.height];e.width=n.width,e.height=n.height,s.drawImage(n,...o),e.remove();let a=s.getImageData(...o).data;const h=new Uint8ClampedArray(n.width*n.height*3);for(let t=0,e=0;t<a.length;t+=4,e+=3)h[e]=a[t],h[e+1]=a[t+1],h[e+2]=a[t+2];return a=null,{shape:[n.width,n.height,3],pixels:h,binary:n}}}const h=/ +/g,u=/\d+/,l=":",c=/\d*:\d*:*\d*/,p="],\n$1[",d=/\]\,(\s*)\[/g,f=/\d+\.?\d*e[+-]?\d+|\d+\.?\d*|\.\d+|./g,m={0:"",1:"i",2:"j",3:"k"},y={"":0,i:1,I:1,j:2,J:2,k:3,K:3},w=Object.assign(Math,{add:function(t,e){return t+e},subtract:function(t,e){return t-e},divide:function(t,e){return t/e},multiply:function(t,e){return t*e}});class b{constructor({size:t,typed:e}){this.size=t,this.typed=e}static promote(t,e){return t.type.size>e.type.size?t.type:e.type}static isTypedArray(t){return void 0!==t&&(t.constructor===Int8Array||t.constructor===Int16Array||t.constructor===Int32Array||t.constructor===Uint8Array||t.constructor===Uint16Array||t.constructor===Uint32Array||t.constructor===Float32Array||t.constructor===Float64Array||t.constructor===Uint8ClampedArray)}static resolve(t){const e=b.parse(t);return 1===e.length?b.Float32:2===e.length?b.ComplexFloat32:e.length>2?b.QuatFloat32:void 0}static parse(t){let e,s=1;const i=[],r=String(t).match(f).filter(function(t){return!h.test(t)});for(let t=0;t<r.length;t++)if((e=r[t])in y)isNaN(r[t-1])&&(i[y[e]]=i[y[e]]||0,i[y[e]]+=s);else if("+"===e)s=1;else if("-"===e)s=-1;else if(!isNaN(e)){let n=r[t+1];n in y?(i[y[n]]=i[y[n]]||0,i[y[n]]+=s*Number(e)):(i[0]=i[0]||0,i[0]+=s*Number(e))}return i}array(t){return b.isTypedArray(t)?t:t.constructor===Array?new this.typed(t.flatMap(function(t){return this.align(b.parse(t))},this)):t.constructor===Number?new this.typed(t*this.size):void 0}align(t){return t.length=this.size,Array.from(t,function(t){return t||0})}}b.Int8=new class extends b{}({size:1,typed:Int8Array}),b.Int16=new class extends b{}({size:1,typed:Int16Array}),b.Int32=new class extends b{}({size:1,typed:Int32Array}),b.Uint8=new class extends b{}({size:1,typed:Uint8Array}),b.Uint16=new class extends b{}({size:1,typed:Uint16Array}),b.Uint32=new class extends b{}({size:1,typed:Uint32Array}),b.Float32=new class extends b{}({size:1,typed:Float32Array}),b.Float64=new class extends b{}({size:1,typed:Float64Array}),b.Uint8Clamped=new class extends b{}({size:1,typed:Uint8ClampedArray}),b.ComplexInt8=new class extends b{}({size:2,typed:Int8Array}),b.ComplexInt16=new class extends b{}({size:2,typed:Int16Array}),b.ComplexInt32=new class extends b{}({size:2,typed:Int32Array}),b.ComplexUint8=new class extends b{}({size:2,typed:Uint8Array}),b.ComplexUint16=new class extends b{}({size:2,typed:Uint16Array}),b.ComplexUint32=new class extends b{}({size:2,typed:Uint32Array}),b.ComplexFloat32=new class extends b{}({size:2,typed:Float32Array}),b.ComplexFloat64=new class extends b{}({size:2,typed:Float64Array}),b.ComplexUint8Clamped=new class extends b{}({size:2,typed:Uint8ClampedArray}),b.QuatInt8=new class extends b{}({size:4,typed:Int8Array}),b.QuatInt16=new class extends b{}({size:4,typed:Int16Array}),b.QuatInt32=new class extends b{}({size:4,typed:Int32Array}),b.QuatUint8=new class extends b{}({size:4,typed:Uint8Array}),b.QuatUint16=new class extends b{}({size:4,typed:Uint16Array}),b.QuatUint32=new class extends b{}({size:4,typed:Uint32Array}),b.QuatFloat32=new class extends b{}({size:4,typed:Float32Array}),b.QuatFloat64=new class extends b{}({size:4,typed:Float64Array}),b.QuatUint8Clamped=new class extends b{}({size:4,typed:Uint8ClampedArray});var g=s(0);class v{constructor(t){this.type=void 0!==t.type?t.type:b.Float32,this.shape=void 0!==t.shape?t.shape:[],this.offset=void 0!==t.offset?t.offset:0,this.contig=void 0===t.contig||t.contig,this.strides=void 0!==t.strides?t.strides:this.resolveStrides(this.shape),this.size=this.shape.reduce(w.multiply,1)}static isContigous(t){let e=t.length;for(let s=t.length-1;s>=0;s--)if(t[s].constructor===String&&t[s].includes(l)){if(s+1!==e)return!1;e=s}else if(e===t.length)return!1;return!0}resolveStrides(t,e=this.type.size){const s=new Array(t.length);s[s.length-1]=e;for(let i=t.length-1;i>0;i--)s[i-1]=e*=t[i];return s}resolveShape(t){const e=new Array(t.length),s=t.reduce(w.multiply,1);for(let i=0;i<t.length;i++)e[i]=t[i]<0?-this.size/s:t[i];return e}copy(){return new v(JSON.parse(JSON.stringify(this)))}literalIndex(t){let e=this.offset;for(let s=0;s<t.length;s++)e+=t[s]*this.strides[s];return e}symbolicIndex(t){let e=[`${this.offset}`];for(const[s,i]of Object.values(t))e.push(`(${s} * ${i})`);return e.join("+")}nonZeroAxes(t){const e={};let s=this.shape.length-1,i=t.length-1;for(;s>=0&&i>=0;s--,i--)this.shape[s]>1&&(e[t[i]]=[`i${t[i]}`,this.strides[s]]);return e}slice(t){const e=new Array,s=new Array,i=v.isContigous(t);let r=this.offset;for(let i=0;i<this.shape.length;i++)if(t[i]===l||void 0===t[i])e.push(this.shape[i]),s.push(this.strides[i]);else if(c.test(t[i])){let[n,o,a]=t[i].split(l).map(Number);0===o&&(o=this.shape[i]),a||(a=1),r+=this.strides[i]*n,e.push(w.ceil((o-n)/a)),s.push(this.strides[i]*a)}else u.test(t[i])&&(r+=this.strides[i]*t[i]);return new v({...this,shape:e,strides:s,offset:r,contig:i})}transpose(){return new v({...this,contig:!1,shape:this.shape.slice().reverse(),strides:this.strides.slice().reverse()})}reshape(t){const e=this.resolveShape(t),s=this.resolveStrides(e);return new v({...this,shape:e,strides:s})}}class T{constructor({header:t,data:e}){Object.assign(this,this.header=t),this.data=this.type.array(e||this.size)}static intersection(t,e){return t.constructor===T&&e.constructor===T&&(t=t.toRawFlat(),e=e.toRawFlat()),t.filter(function(t){return e.includes(t)})}static difference(t,e){return t.constructor===T&&e.constructor===T&&(t=t.toRawFlat(),e=e.toRawFlat()),t.filter(function(t){return!e.includes(t)})}static shape(t,e=[]){return t.constructor===T?t.shape:b.isTypedArray(t)?[t.length]:t.constructor!==Array?e:T.shape(t[0],e.concat(t.length))}static tensor({data:t,type:e}){if(void 0===t)return T.zeros();if(t.constructor===T)return t;const s=T.shape(t);return t.constructor!==String&&t.constructor!==Number&&t.constructor!==Array||(t=[t].flat(Number.POSITIVE_INFINITY)),e=e||b.resolve(t[0]),new T({data:t,header:new v({type:e,shape:s})})}static zerosLike({tensor:t}){return new T({header:new v({...t})})}static zeros({shape:t,type:e}={}){return new T({header:new v({shape:t,type:e})})}static onesLike({tensor:t}){return(t=new T({header:new v({...t})})).data.fill(1),t}static ones({shape:t,type:e}){const s=new T({header:new v({shape:t,type:e})});return s.data.fill(1),s}static arange({start:t=0,step:e=1,stop:s,type:i}){const r=new T({header:new v({type:i,shape:[w.round((s-t)/e)]})});for(let i=t,n=0;i<s;i+=e,n++)r.data[n]=i;return r}static linspace({start:t,stop:e,num:s=50,type:i}){const r=(e-t)/s,n=new T({header:new v({type:i,shape:[s]})});for(let s=t,i=0;s<e;s+=r,i+=n.type.size)n.data[i]=s;return n}static rand({shape:t,type:e}){const s=new T({header:new v({shape:t,type:e})});for(let t=0;t<s.data.length;t++)s.data[t]=w.random();return s}static randrange({low:t,high:e,shape:s,type:i}){const r=new T({header:new v({shape:s,type:i})});for(let s=0;s<r.data.length;s++)r.data[s]=t+w.floor(w.random()*(e-t));return r}static eye({shape:t,type:e}){const s=new T({header:new v({shape:t,type:e})}),i=s.strides.reduce(w.add),r=w.min(...s.shape);for(let t=0;t<r*i;t+=i)s.data[t]=1;return s}astype({type:t}){if(t===this.type)return this;if(1===this.size)return this;const e=this.toRaw().flat(Number.POSITIVE_INFINITY),s=t.array(this.size);for(let i=0,r=0;i<e.length;i++,r+=t.size)for(let n=0,o=b.parse(e[i]);n<w.min(t.size,this.type.size);n++)s[r+n]=o[n];return new T({header:new v({type:t,shape:this.shape}),data:s})}view({type:t}){if(t===this.type)return this;if(!this.contig)return this;const e=this.type.size/t.size;return this.size*=e,this.header.type=this.type=t,this.shape[this.shape.length-1]*=e,this.strides[this.strides.length-1]/=e,this}copy(){return new T({header:this.header,data:this.data.slice()})}ravel(){return T.tensor({data:this.toRaw(),type:this.type}).reshape({shape:[-1]})}slice({region:t}){return new T({header:this.header.slice(t),data:this.data})}T(){return new T({header:this.header.transpose(),data:this.data})}reshape({shape:t}){return this.contig?new T({header:this.header.reshape(t),data:this.data}):T.tensor({data:this.toRaw(),type:this.type}).reshape({shape:t})}visit(t=this.toStringAtIndex.bind(this),e=this.offset,s=0){return this.shape.length&&s!==this.shape.length?[...new Array(this.shape[s]).keys()].map(function(i){return this.visit(t,i*this.strides[s]+e,s+1)},this):t(e)}toRaw(){return this.visit()}toRawFlat(){return this.visit().flat(Number.POSITIVE_INFINITY)}toIndices(){const t=[];return this.visit(function(e){t.push(e)}),t}toStringAtIndex(t,e=""){for(let s=0;s<this.type.size;s++){const i=w.sign(this.data[t+s])<0?"-":"+",r=w.abs(this.data[t+s]);r&&(e+=`${i}${r.toPrecision()}${m[s]}`)}return e?e.startsWith("+")?e.slice(1):e:"0"}toString(){return JSON.stringify(this.toRaw()).replace(d,p)}[g.inspect.custom](){return this.toString()}}class x{constructor(t=[]){this.chain=t.join("\n")}nestedFor(t,e,s){return this.chain+=t.map(function(s,i){const r=`i${t[i]}`;return`for(let ${r} = 0;${r} < ${`${e[i]}`};${r}++){`},this).concat(s).concat(["}".repeat(t.length)]).join("\n"),this}for(t,e,s){return this.chain+=`for (${t}; ${e}; ${s})`,this}let(t){return this.chain+=`let ${t}`,this}plus(t){return this.chain+=`+ ${t} `,this}const(t){return this.chain+=`const ${t}`,this}equals(t){return this.chain+=` = ${t} `,this}if(t){return this.chain+=`if (${t})`,this}elseIf(t){return this.chain+=`else if (${t})`,this}then(t){return this.chain+=["{",...t,"}"].join("\n"),this}else(t){return this.chain+=["else {",...t,"}"].join("\n"),this}toString(){return this.chain}}class I{static split(t=[],e=[]){return[t.slice(0,t.length/2),t.slice(t.length/2),e.slice(0,e.length/2),e.slice(e.length/2)]}static match(t,e){const s=Math.max(t.length,e.length);return t.length=s,e.length=s,[Array.from(t,function(t){return t||0}),Array.from(e,function(t){return t||0})]}static variable({symbol:t,size:e,index:s}){return new Array(e).fill(null).map(function(e,i){return`${t}[${s}+${i}]`})}static ONE(t){return new Array(t).fill(1)}static ZERO(t){return new Array(t).fill(0)}static POSITIVE_INFINITY(t){return Array(t).fill(Number.POSITIVE_INFINITY)}static NEGATIVE_INFINITY(t){return Array(t).fill(Number.NEGATIVE_INFINITY)}static noop(t,e){if([t,e]=I.match(t,e),1===t.length)return[`(${t})`];const[s,i,r,n]=I.split(t,e);return[I.noop(s,r),I.noop(i,n)].flat(Number.POSITIVE_INFINITY)}static exp(t){if(1===t.length)return[`Math.exp(${t})`];const[e,s]=I.split(t);return 2===t.length?I.scale([I.cos(s),I.sin(s)],I.exp(e)):[I.exp(e),I.exp(s)].flat(Number.POSITIVE_INFINITY)}static sin(t){if(1===t.length)return[`Math.sin(${t})`];const[e,s]=I.split(t);return[I.sin(e),I.sin(s)].flat(Number.POSITIVE_INFINITY)}static cos(t){if(1===t.length)return[`Math.cos(${t})`];const[e,s]=I.split(t);return[I.cos(e),I.cos(s)].flat(Number.POSITIVE_INFINITY)}static lessThan(t,e){if([t,e]=I.match(t,e),1===t.length)return[`(${t}<${e})`];const[s,i,r,n]=I.split(t,e);return[I.lessThan(s,r),I.lessThan(i,n)].flat(Number.POSITIVE_INFINITY)}static greaterThan(t,e){if([t,e]=I.match(t,e),1===t.length)return[`(${t}>${e})`];const[s,i,r,n]=I.split(t,e);return[I.greaterThan(s,r),I.greaterThan(i,n)].flat(Number.POSITIVE_INFINITY)}static add(t,e){if([t,e]=I.match(t,e),1===t.length)return[`(${t}+${e})`];const[s,i,r,n]=I.split(t,e);return[I.add(s,r),I.add(i,n)].flat(Number.POSITIVE_INFINITY)}static subtract(t,e){if([t,e]=I.match(t,e),1===t.length)return[`(${t}-${e})`];const[s,i,r,n]=I.split(t,e);return[I.subtract(s,r),I.subtract(i,n)].flat(Number.POSITIVE_INFINITY)}static multiply(t,e){if([t,e]=I.match(t,e),1===t.length)return[`${t}*${e}`];const[s,i,r,n]=I.split(t,e);return[I.subtract(I.multiply(s,r),I.multiply(I.conjugate(n),i)),I.add(I.multiply(n,s),I.multiply(i,I.conjugate(r)))].flat(Number.POSITIVE_INFINITY)}static divide(t,e,s){return[e,s]=I.match(e,s),1===e.length?[`${t}=(${e}/${s})`]:[`var mod = (1/${I.sum(I.square(s))})`,I.assign(t,I.scale(I.multiply(e,I.conjugate(s)),"mod"))].join("\n")}static squareRoot(t){if(1===t.length)return[`Math.sqrt(${t})`];const[e,s]=I.split(t);return[I.squareRoot(e),I.squareRoot(s)].flat(Number.POSITIVE_INFINITY)}static sum(t){if(1===t.length)return[`(${t})`];const[e,s]=I.split(t);return I.add(I.sum(e),I.sum(s))}static scale(t,e){if(1===t.length)return[`(${t}*${e})`];const[s,i]=I.split(t);return[I.scale(s,e),I.scale(i,e)].flat(Number.POSITIVE_INFINITY)}static square(t){if(1===t.length)return[`(${t}*${t})`];const[e,s]=I.split(t);return[I.square(e),I.square(s)].flat(Number.POSITIVE_INFINITY)}static conjugate(t){if(1===t.length)return[`(${t})`];const[e,s]=I.split(t);return[I.conjugate(e),I.negate(s)].flat(Number.POSITIVE_INFINITY)}static negate(t){if(1===t.length)return[`-(${t})`];const[e,s]=I.split(t);return[I.negate(e),I.negate(s)].flat(Number.POSITIVE_INFINITY)}static assign(t,e,s="="){if(1===t.length)return[`${t}${s}${e}`];const[i,r,n,o]=I.split(t,e);return[I.assign(i,n,s),I.assign(r,o,s)].flat(Number.POSITIVE_INFINITY)}}class A{constructor(t){this.of=T.tensor({data:t.of}),this.with=T.tensor({data:t.with}),this.type=b.promote(this.of,this.with),this.of=this.of.astype({type:this.type}),this.with=this.with.astype({type:this.type})}shape(t){return this.shape[t]}size(t,e){return t*this.shape[e]}symbolicSourceBoilerplate(){this.indices={},this.indices.of=new x([`const AIndex = ${this.of.header.symbolicIndex(this.axes.of)}`]),this.indices.with=new x([`const BIndex = ${this.with.header.symbolicIndex(this.axes.with)}`]),this.indices.result=new x([`const RIndex = ${this.result.header.symbolicIndex(this.axes.result)}`]),this.variables={},this.variables.of=I.variable({symbol:"A.data",index:"AIndex",size:this.of.type.size}),this.variables.with=I.variable({symbol:"B.data",index:"BIndex",size:this.with.type.size}),this.variables.result=I.variable({symbol:"R.data",index:"RIndex",size:this.result.type.size}),this.variables.temp=I.variable({symbol:"temp",index:0,size:this.result.type.size})}}class O extends A{constructor(t){super(t),this.axes={},this.axes.inner=t.axes,this.axes.total=[...this.of.shape.keys()],this.axes.outer=T.difference(this.axes.total,this.axes.inner),this.axes.order=this.axes.outer.concat(this.axes.inner),this.axes.last=this.axes.order[this.axes.order.length-1],this.shapes={},this.shapes.outer=this.axes.outer.map(this.shape.bind(this.of)),this.shapes.inner=this.axes.inner.map(this.shape.bind(this.of)),this.sizes={},this.sizes.outer=this.axes.outer.reduce(this.size.bind(this.of),1),this.sizes.inner=this.axes.inner.reduce(this.size.bind(this.of),1)}unselectedAxes(t,e){return!this.axes.inner.includes(e)}resultant(){return T.zeros({type:this.of.type,shape:this.of.shape.filter(this.unselectedAxes,this)})}symbolicSourceBoilerplate(){this.axes.of=this.axes.of||this.of.header.nonZeroAxes(this.axes.total),this.axes.with=this.axes.with||this.with.header.nonZeroAxes(this.axes.inner),this.axes.result=this.axes.result||this.result.header.nonZeroAxes(this.axes.outer),super.symbolicSourceBoilerplate()}symbolicSourceTemplate(){this.source=new x([this.start(),(new x).nestedFor(this.axes.outer,this.shapes.outer,[this.preLoop(),(new x).nestedFor(this.axes.inner,this.shapes.inner,[this.inLoop()]),this.postLoop()]),this.finish()])}}class N extends O{constructor(t){t.axes=t.axes||[],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){return new x([this.indices.result])}inLoop(){return new x([this.indices.of,I.assign(this.variables.result,I.exp(this.variables.of))])}postLoop(){}finish(){}}class S extends O{constructor(t){t.axes=t.axes||[],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){return new x([this.indices.result])}inLoop(){return new x([this.indices.of,I.assign(this.variables.result,I.cos(this.variables.of))])}postLoop(){}finish(){}}class E extends O{constructor(t){t.axes=t.axes||[...t.of.shape.keys()],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){return new x([`const temp = new Array(${this.of.type.size})`])}preLoop(){return new x(["temp.fill(Number.NEGATIVE_INFINITY)",this.indices.result])}inLoop(){return new x([this.indices.of,(new x).if(I.greaterThan(this.variables.of,this.variables.temp).slice(0,1)).then(I.assign(this.variables.temp,this.variables.of))])}postLoop(){return I.assign(this.variables.result,this.variables.temp)}finish(){}}class z extends O{constructor(t){t.axes=t.axes||[],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){return new x([this.indices.result])}inLoop(){return new x([this.indices.of,I.assign(this.variables.result,I.sin(this.variables.of))])}postLoop(){}finish(){}}class R extends O{constructor(t){t.axes=t.axes||[...t.of.shape.keys()],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){return new x([`const temp = new Array(${this.of.type.size})`])}preLoop(){return new x([this.indices.result,"temp.fill(0)"])}inLoop(){return new x([this.indices.of,I.assign(this.variables.temp,this.variables.of,"+=")])}postLoop(){return I.assign(this.variables.result,this.variables.temp)}finish(){}}class k extends O{constructor(t){t.axes=t.axes||[...t.of.shape.keys()],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){return new x([`const temp = new Array(${this.of.type.size})`])}preLoop(){return new x(["temp.fill(Number.POSITIVE_INFINITY)",this.indices.result])}inLoop(){return new x([this.indices.of,(new x).if(I.lessThan(this.variables.of,this.variables.temp).slice(0,1)).then(I.assign(this.variables.temp,this.variables.of))])}postLoop(){return I.assign(this.variables.result,this.variables.temp)}finish(){}}class F extends O{constructor(t){t.axes=t.axes||[...t.of.shape.keys()],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){return new x([`const temp = new Array(${this.of.type.size})`])}preLoop(){return new x([this.indices.result,"temp.fill(0)"])}inLoop(){return new x([this.indices.of,I.assign(this.variables.temp,this.variables.of,"+=")])}postLoop(){return I.assign(this.variables.result,I.scale(this.variables.temp,1/this.sizes.inner))}finish(){}}class C extends O{constructor(t){t.axes=t.axes||[...t.of.shape.keys()],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}resultant(){return T.zeros({type:T.Float32,shape:this.of.shape.filter(function(t,e){return!this.axes.inner.includes(e)},this)})}start(){return new x([`const temp = new Array(${this.of.type.size})`])}preLoop(){return new x([this.indices.result,"temp.fill(0)"])}inLoop(){return new x([this.indices.of,I.assign(this.variables.temp.slice(0,1),I.sum(I.square(this.variables.of)),"+=").slice(0,1)])}postLoop(){return I.assign(this.variables.result,I.squareRoot(this.variables.temp))}finish(){}}class _ extends A{constructor(t){super(t),this.result=t.result||this.resultant(),this.axes={},this.axes.total=[...new Array(w.max(this.of.shape.length,this.with.shape.length)).keys()],this.shapes={},this.sizes={}}resultant(){const t=[],e=w.max(this.of.shape.length,this.with.shape.length);for(let s=0;s<e;s++){const e=this.with.shape.length-1-s,i=this.of.shape.length-1-s;1===this.with.shape[e]||void 0===this.with.shape[e]?t.push(this.of.shape[i]):1===this.of.shape[i]||void 0===this.of.shape[i]?t.push(this.with.shape[e]):this.with.shape[e]===this.of.shape[i]&&t.push(this.of.shape[i])}return T.zeros({shape:t.reverse(),type:this.of.type})}symbolicSourceBoilerplate(){this.shapes.total=this.shapes.total||this.axes.total.map(this.shape.bind(this.result)),this.sizes.total=this.sizes.total||this.axes.total.reduce(this.size.bind(this.result),1),this.axes.of=this.of.header.nonZeroAxes(this.axes.total),this.axes.with=this.with.header.nonZeroAxes(this.axes.total),this.axes.result=this.result.header.nonZeroAxes(this.axes.total),super.symbolicSourceBoilerplate()}symbolicSourceTemplate(){this.source=new x([this.start(),(new x).nestedFor(this.axes.total,this.shapes.total,[Object.values(this.indices).join("\n"),this.inLoop()]),this.finish()])}}class j extends _{constructor(t){super(t),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){}inLoop(){return I.divide(this.variables.result,this.variables.of,this.variables.with)}postLoop(){}finish(){}}class L extends O{constructor(t){t.axes=t.axes||[],super(t),this.result=t.result||this.resultant(),this.norm=new C({of:this.of}),this.divide=new j({of:this.of,with:this.norm.result,result:this.result})}resultant(){return T.zeros(this.of)}invoke(){return this.norm.invoke(),this.divide.invoke()}}class B extends O{constructor(t){t.axes=t.axes||[],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){return new x([this.indices.result])}inLoop(){return new x([this.indices.of,I.assign(this.variables.result,I.negate(this.variables.of))])}postLoop(){}finish(){}}class P extends O{constructor(t){t.axes=t.axes||[t.of.shape.length-1],super(t),this.count=t.count||1,this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}resultant(){return T.zeros({type:this.of.type,shape:this.of.shape.map(function(t,e){return e===this.axes.inner[0]?this.count*t:t},this)})}symbolicSourceBoilerplate(){this.axes.of=this.of.header.nonZeroAxes(this.axes.total),this.axes.with=this.with.header.nonZeroAxes(this.axes.total),this.axes.result=this.result.header.nonZeroAxes(this.axes.total),this.axes.result[this.axes.last][0]="r",super.symbolicSourceBoilerplate()}start(){}preLoop(){}inLoop(){return new x([this.indices.of,(new x).for(`let r = i${this.axes.last}*${this.count}, c = 0`,`c < ${this.count}`,"r++, c++").then([this.indices.result,I.assign(this.variables.result,this.variables.of)])])}postLoop(){}finish(){}}class M extends O{constructor(t){t.axes=t.axes||[t.of.shape.length-1],super(t),this.entries=t.entries.sort(w.subtract).map(Number),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(this,this.of,this.with,this.result))}resultant(){return T.zeros({type:this.of.type,shape:this.of.shape.map(function(t,e){return e===this.axes.inner[0]?t+this.entries.length:t},this)})}symbolicSourceBoilerplate(){this.axes.of=this.of.header.nonZeroAxes(this.axes.total),this.axes.of[this.axes.last][0]=`(i${this.axes.last} - seen)`,this.axes.with=this.with.header.nonZeroAxes(this.axes.total),this.axes.result=this.result.header.nonZeroAxes(this.axes.total),this.shapes={},this.shapes.outer=this.axes.outer.map(super.shape.bind(this.result)),this.shapes.inner=this.axes.inner.map(super.shape.bind(this.result)),super.symbolicSourceBoilerplate()}start(){return new x(["let seen = 0"])}preLoop(){return new x(["seen = 0"])}inLoop(){return new x([new x(Object.values(this.indices)),new x([`const insert = (this.entries[seen] + seen) === i${this.axes.inner[0]}`]),(new x).if("insert").then(["seen++",...I.assign(this.variables.result,this.variables.with)]).else([...I.assign(this.variables.result,this.variables.of)])])}postLoop(){}finish(){}}class X extends O{constructor(t){t.axes=t.axes||[],super(t),this.result=t.result||this.resultant(),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){return new x([this.indices.result])}inLoop(){return new x([this.indices.of,I.assign(this.variables.result,I.square(this.variables.of))])}postLoop(){}finish(){}}class $ extends _{constructor(t){super(t),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){}inLoop(){return I.assign(this.variables.result,I.add(this.variables.of,this.variables.with)).join("\n")}postLoop(){}finish(){}}class U extends _{constructor(t){super({...t,of:t.of.slice({region:t.region||[]}),result:t.of}),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")).bind(this),t.template||(this.invoke=this.invoke.bind(this,this.of,this.with,this.result))}symbolicSourceBoilerplate(){this.shapes.total=this.axes.total.map(this.shape.bind(this.of)),this.sizes.total=this.axes.total.reduce(this.size.bind(this.of),1),super.symbolicSourceBoilerplate()}start(){}preLoop(){}inLoop(){return I.assign(this.variables.of,this.variables.with).join("\n")}postLoop(){}finish(){}}class V extends _{constructor(t){super(t),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){}inLoop(){return I.assign(this.variables.result,I.subtract(this.variables.of,this.variables.with)).join("\n")}postLoop(){}finish(){}}class D extends _{constructor(t){super(t),this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){}preLoop(){}inLoop(){return I.assign(this.variables.result,I.multiply(this.variables.of,this.variables.with)).join("\n")}postLoop(){}finish(){}}class Y extends A{constructor(t){super(t),this.rows=this.of.shape[0],this.cols=this.with.shape[1]||this.of.shape[1],this.like=this.of.shape[1],this.size=this.rows}resultant(){return T.zeros(this.of)}pointwiseSourceBoilerplate(){}pointwiseSourceTemplate(){for(this.start(),this.r=0;this.r<this.rows;this.r++)for(this.c=0;this.c<this.cols;this.c++)this.inLoop();this.finish()}symbolicSourceBoilerplate(){}symbolicSourceTemplate(){}}class G extends Y{constructor(t){super(t),this.result=t.result||this.resultant(),this.pointwiseSourceBoilerplate(),this.pointwiseSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}resultant(){return T.zeros({shape:[3,1],type:this.of.type})}pointwiseSourceTemplate(){const t=[],e=[],s=[];for(let i=0;i<3;i++)t.push(I.variable({symbol:"A.data",index:this.of.header.literalIndex([i,0]),size:this.of.type.size})),e.push(I.variable({symbol:"B.data",index:this.with.header.literalIndex([i,0]),size:this.with.type.size})),s.push(I.variable({symbol:"R.data",index:this.result.header.literalIndex([i,0]),size:this.result.type.size}));this.source=[I.assign(s[0],I.add(I.negate(I.multiply(t[2],e[1])),I.multiply(e[2],t[1]))),I.assign(s[1],I.add(I.negate(I.multiply(t[0],e[2])),I.multiply(e[0],t[2]))),I.assign(s[2],I.subtract(I.multiply(t[0],e[1]),I.multiply(e[0],t[1])))].join("\n")}}const H=function(t){const e=[];for(let s=0;s<t;s++)for(let i=0;i<t;i++)e.push([s,i]);return e};class Z extends Y{constructor(t){super(t),this.result=t.result||this.resultant(),this.pointwiseSourceBoilerplate(),this.pointwiseSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}resultant(){return T.zeros({shape:[],type:this.of.type})}static subMatrix(t,e,s){const i=Math.sqrt(t.length);return t.filter(function(t,r){return r%i!==s&&Math.floor(r/i)!==e})}static determinant(t,e=H(t.shape[0])){if(1===e.length)return I.variable({symbol:"A.data",size:t.type.size,index:t.header.literalIndex(e[0])});const s=[],i=Math.sqrt(e.length);for(let r=0;r<i;r++){const i=Z.subMatrix(e,0,r),n=Z.determinant(t,i),o=I.variable({symbol:"A.data",size:t.type.size,index:t.header.literalIndex(e[r])}),a=I.multiply(o,n);s.push(Math.pow(-1,r%2)>0?a:I.negate(a))}return s.reduce(I.add)}pointwiseSourceBoilerplate(){this.variables={},this.variables.result=I.variable({symbol:"R.data",index:this.result.offset,size:this.result.type.size})}pointwiseSourceTemplate(){this.source=[I.assign(this.variables.result,Z.determinant(this.of))].join("\n")}}class J extends Y{constructor(t){super(t),this.result=t.result||this.resultant(),super.pointwiseSourceBoilerplate(),super.pointwiseSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){this.source=[]}inLoop(){const t=Math.pow(-1,(this.r+this.c)%2),e=Z.subMatrix(H(this.size),this.c,this.r),s=Z.determinant(this.of,e),i=t<0?I.negate(s):s;this.source.push(I.assign(I.variable({index:this.result.header.literalIndex([this.r,this.c]),symbol:"R.data",size:this.result.type.size}),i))}finish(){this.source=this.source.join("\n")}determinant(){const t=[`const D = new Array(${this.of.type.size})`],e=I.variable({symbol:"D",size:this.of.type.size,index:0}),s=new Array(this.size).fill(null).map(function(t,e){return I.multiply(I.variable({symbol:"A.data",size:this.of.type.size,index:this.of.header.literalIndex([0,e])}),I.variable({symbol:"R.data",size:this.of.type.size,index:this.result.header.literalIndex([e,0])}))},this).reduce(I.add);return t.push(I.assign(e,s)),t.join("\n")}}class q extends Y{constructor(t){super(t),this.result=t.result||this.resultant(),super.pointwiseSourceBoilerplate(),super.pointwiseSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")).bind(this),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}start(){this.adjugate=new J({of:this.of}),this.source=[`const T = new Array(${this.of.type.size})`,this.adjugate.source,this.adjugate.determinant()]}inLoop(){const t=I.variable({symbol:"T",size:this.of.type.size,index:0}),e=I.variable({symbol:"D",size:this.of.type.size,index:0}),s=I.variable({symbol:"R.data",index:this.result.header.literalIndex([this.r,this.c]),size:this.result.type.size});this.source.push(I.divide(t,s,e)),this.source.push(I.assign(s,t))}finish(){this.source=this.source.flat(Number.POSITIVE_INFINITY).join("\n")}}class W extends Y{constructor(t){super(t),this.result=t.result||this.resultant(),this.like<40&&(this.pointwiseSourceBoilerplate(),this.pointwiseSourceTemplate()),this.like>40&&(this.symbolicSourceBoilerplate(),this.symbolicSourceTemplate()),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")),t.template||(this.invoke=this.invoke.bind(null,this.of,this.with,this.result))}resultant(){return T.zeros({type:this.of.type,shape:[this.of.shape[0],this.with.shape[1]]})}start(){this.source=[]}inLoop(){const t=I.variable({symbol:"R.data",size:this.result.type.size,index:this.result.header.literalIndex([this.r,this.c])}),e=new Array(this.like).fill(null).map(function(t,e){const s=I.variable({symbol:"A.data",size:this.of.type.size,index:this.of.header.literalIndex([this.r,e])}),i=I.variable({symbol:"B.data",size:this.with.type.size,index:this.with.header.literalIndex([e,this.c])});return I.multiply(s,i)},this).reduce(I.add);this.source.push(I.assign(t,e))}finish(){this.source=this.source.join("\n")}symbolicSourceBoilerplate(){this.variables={},this.variables.of=I.variable({symbol:"A.data",size:this.of.type.size,index:"AIndex"}),this.variables.with=I.variable({symbol:"B.data",size:this.with.type.size,index:"BIndex"}),this.variables.result=I.variable({symbol:"R.data",size:this.result.type.size,index:"RIndex"}),this.indices={},this.indices.of="const AIndex = r * A.strides[0] + s * A.strides[1] + A.offset",this.indices.with="const BIndex = r * B.strides[0] + s * B.strides[1] + B.offset",this.indices.result="const RIndex = r * R.strides[0] + c * R.strides[1] + R.offset"}symbolicSourceTemplate(){this.source=["for (let r = 0; r < A.shape[0]; r++){","for (let c = 0; c < B.shape[1]; c++){",this.indices.result,"R.data[RIndex] = 0","for (let s = 0; s < A.shape[1]; s++) {",this.indices.of,this.indices.with,I.assign(this.variables.result,I.multiply(this.variables.of,this.variables.with),"+="),"}}}"].join("\n")}}class Q{constructor(t){this.of=t.of,this.axes=[...this.of.keys()],this.shapes=this.of.map(function(t){return t.length}),this.result=t.result||this.resultant(),this.symbolicSourceTemplate(),this.invoke=new Function("A,B,R",[this.source,"return R"].join("\n")).bind(this),t.template||(this.invoke=this.invoke.bind(this,this.of,this.with,this.result))}symbolicSourceTemplate(){this.source=new x(["let i = 0",(new x).nestedFor(this.axes,this.shapes,[this.of.map(function(t,e){return`R.data[i++] = A[${e}][i${e}]`})])])}size(t,e){return t*e.length}resultant(){return T.zeros({shape:[this.of.reduce(this.size,1),this.of.length]})}}const K={...n,...i,...r,...o};var tt={...K,wrap:function(t){return Object.fromEntries(Object.entries(K).map(t))}};Object.assign(T,b),Object.assign(T,tt.wrap(function([t,e]){return[t,function(t){return new e(t).invoke()}]})),Object.assign(T.prototype,tt.wrap(function([t,e]){return[t,function(t){return new e({of:this,...t}).invoke()}]})),T.cached=tt;var et=T;class st{constructor(){this.position={x:0,y:0},this.isPressed=!1}mouseup(){this.isPressed=!1}mousedown(t){this.isPressed=!0,this.position.x=t.clientX,this.position.y=t.clientY}mousemove(t){this.position.x=t.clientX,this.position.y=t.clientY}}class it{constructor(t){this.keys=new Set,this.bindings=t}keyup(){this.keys.clear()}keydown(t){this.keys.add(t.key);const e=Array.from(this.keys).sort().join("|");return this.bindings[e]}}var rt={CANVAS_STROKE_COLOR:"white",CANVAS_FILL_COLOR:"rgba(255, 165, 0, 1)",HUD_FONT:"18px serif",HUD_COLOR:"rgba(255, 255, 255, 1)",HUD_TEXT_LOCATION:[10,50],BINDINGS:{o:{name:"zoom",args:[!0]},i:{name:"zoom",args:[!1]},ArrowUp:{name:"pan",args:[0]},ArrowDown:{name:"pan",args:[1]},ArrowLeft:{name:"pan",args:[2]},ArrowRight:{name:"pan",args:[3]}},VERTEX_SOURCE:"attribute float a_PointSize;\nattribute vec4 a_Position;\nattribute vec4 a_Color;\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjMatrix;\nvarying vec4 v_Color;\nvoid main() {\n  gl_PointSize = a_PointSize;\n  gl_Position = u_ProjMatrix * u_ViewMatrix * a_Position;\n  v_Color = a_Color;\n}\n",FRAGMENT_SOURCE:"precision mediump float;\nvarying vec4 v_Color;\nvoid main() {\n  gl_FragColor = v_Color;\n}\n",UP:et.tensor({data:[[0],[1],[0],[1]]}),TO:et.tensor({data:[["0"],["0"],["0"],["1"]]}),FROM:et.tensor({data:[["7"],["3"],["1"],["1"]]}),LOOK_MATRIX:et.eye({shape:[4,4]}),VIEW_MATRIX:et.eye({shape:[4,4]}),TRANSLATION_MATRIX:et.eye({shape:[4,4]}),PROJECTION_MATRIX:et.zeros({shape:[4,4]}),VIEWING_ANGLE:30,ASPECT_RATIO:1,NEAR:1e-6,FAR:1e6,ZOOM_DELTA:.02,PAN_DELTA:Math.PI/128,DIRECTIONS:{UP:0,DOWN:1,LEFT:2,RIGHT:3}};class nt{constructor({CANVAS:t}){this.CONTEXT=t.getContext("webgl"),this.program=this.createProgram(),this.uniforms=this.createUniforms(),this.attributes=this.createAttributes(),this.CONTEXT.useProgram(this.program)}createUniforms(){const t={},e=this.CONTEXT.getProgramParameter(this.program,this.CONTEXT.ACTIVE_UNIFORMS);for(let s=0;s<e;s++){const e=this.CONTEXT.getActiveUniform(this.program,s),i=this.CONTEXT.getUniformLocation(this.program,e.name);t[e.name]=this.createUniform(e.type,i)}return t}createUniform(t,e){return t===this.CONTEXT.FLOAT_MAT2?function(t){this.CONTEXT.uniformMatrix2fv(e,!1,t.data)}.bind(this):t===this.CONTEXT.FLOAT_MAT3?function(t){this.CONTEXT.uniformMatrix3fv(e,!1,t.data)}.bind(this):t===this.CONTEXT.FLOAT_MAT4?function(t){this.CONTEXT.uniformMatrix4fv(e,!1,t.data)}.bind(this):void 0}createBuffer(t){const e=this.CONTEXT.createBuffer(),s=this.mapType(t.type.typed),i=this.CONTEXT.STATIC_DRAW,r=this.CONTEXT.ARRAY_BUFFER;return this.CONTEXT.bindBuffer(r,e),this.CONTEXT.bufferData(r,t.data,i),{buffer:e,size:t.shape[1],count:t.shape[0],type:s,normalize:!1,offset:t.offset*t.data.BYTES_PER_ELEMENT,stride:t.strides[0]*t.data.BYTES_PER_ELEMENT}}mapType(t){return t===Int8Array?this.CONTEXT.BYTE:t===Uint8Array?this.CONTEXT.UNSIGNED_BYTE:t===Uint8ClampedArray?this.CONTEXT.UNSIGNED_BYTE:t===Int16Array?this.CONTEXT.SHORT:t===Uint16Array?this.CONTEXT.UNSIGNED_SHORT:t===Int32Array?this.CONTEXT.INT:t===Uint32Array?this.CONTEXT.UNSIGNED_INT:t===Float32Array?this.CONTEXT.FLOAT:null}createAttributes(){const t={},e=this.CONTEXT.getProgramParameter(this.program,this.CONTEXT.ACTIVE_ATTRIBUTES);for(var s=0;s<e;s++){const e=this.CONTEXT.getActiveAttrib(this.program,s),i=this.CONTEXT.getAttribLocation(this.program,e.name);t[e.name]=this.createAttribute(i)}return t}createAttribute(t){return function(e){this.CONTEXT.bindBuffer(this.CONTEXT.ARRAY_BUFFER,e.buffer),this.CONTEXT.enableVertexAttribArray(t),this.CONTEXT.vertexAttribPointer(t,e.size,e.type,e.normalize,e.stride,e.offset)}.bind(this)}createShader(t,e){const s=this.CONTEXT.createShader(t);return this.CONTEXT.shaderSource(s,e),this.CONTEXT.compileShader(s),this.CONTEXT.getShaderParameter(s,this.CONTEXT.COMPILE_STATUS)?s:(console.error(`Error with compile: ${this.CONTEXT.getShaderInfoLog(s)}`),this.CONTEXT.deleteShader(s),null)}createProgram(){const t=this.CONTEXT.createProgram();return this.CONTEXT.attachShader(t,this.createShader(this.CONTEXT.VERTEX_SHADER,rt.VERTEX_SOURCE)),this.CONTEXT.attachShader(t,this.createShader(this.CONTEXT.FRAGMENT_SHADER,rt.FRAGMENT_SOURCE)),this.CONTEXT.linkProgram(t),this.CONTEXT.getProgramParameter(t,this.CONTEXT.LINK_STATUS)?t:(console.error(`Error with link: ${this.CONTEXT.getProgramInfoLog(t)}`),this.CONTEXT.deleteProgram(t),null)}}class ot{constructor(){const t=Math.sin(rt.PAN_DELTA),e=Math.cos(rt.PAN_DELTA);this.upRot=et.tensor({data:[[1,0,0,0],[0,e,-t,0],[0,t,e,0],[0,0,0,1]]}),this.downRot=et.tensor({data:[[1,0,0,0],[0,e,t,0],[0,-t,e,0],[0,0,0,1]]}),this.leftRot=et.tensor({data:[[e,0,t,0],[0,1,0,0],[-t,0,e,0],[0,0,0,1]]}),this.rightRot=et.tensor({data:[[e,0,-t,0],[0,1,0,0],[t,0,e,0],[0,0,0,1]]}),this.inverseView=new et.cached.inverse({of:rt.LOOK_MATRIX}),this.setRotation=new et.cached.matMult({of:this.inverseView.result.T(),with:et.zeros({shape:[4,4]}),template:!0}),this.setViewMatrix=new et.cached.matMult({of:this.setRotation.result,with:rt.LOOK_MATRIX.T()}),this.setPosition=new et.cached.matMult({of:this.setViewMatrix.result,with:rt.TO,result:rt.TO}),this.invoke=this.invoke.bind(this)}rotate(t){return this.setRotation.invoke(this.setRotation.of,t,this.setRotation.result),this.setViewMatrix.invoke(),this.setPosition.invoke()}invoke(t){switch(this.inverseView.invoke(),t){case rt.DIRECTIONS.UP:return this.rotate(this.upRot);case rt.DIRECTIONS.DOWN:return this.rotate(this.downRot);case rt.DIRECTIONS.LEFT:return this.rotate(this.leftRot);case rt.DIRECTIONS.RIGHT:return this.rotate(this.rightRot)}}}class at{constructor(){this.negateFrom=new et.cached.negate({of:rt.FROM}),this.front=new et.cached.subtract({of:rt.FROM,with:rt.TO}),this.side=new et.cached.cross({of:rt.UP,with:this.front.result}),this.unitSide=new et.cached.unit({of:this.side.result}),this.unitFront=new et.cached.unit({of:this.front.result}),this.unitUp=new et.cached.cross({of:this.unitFront.result,with:this.unitSide.result}),this.assignUpFrame=new et.cached.assign({of:rt.VIEW_MATRIX,region:[":3","1:2"],with:this.unitUp.result}),this.assignSideFrame=new et.cached.assign({of:rt.VIEW_MATRIX,region:[":3","0:1"],with:this.unitSide.result}),this.assignFrontFrame=new et.cached.assign({of:rt.VIEW_MATRIX,region:[":3","2:3"],with:this.unitFront.result}),this.assignTranslation=new et.cached.assign({of:rt.TRANSLATION_MATRIX,region:["3:4",":3"],with:this.negateFrom.result.T()}),this.look=new et.cached.matMult({of:rt.TRANSLATION_MATRIX,with:rt.VIEW_MATRIX,result:rt.LOOK_MATRIX}),this.invoke=this.invoke.bind(this)}invoke(){return this.negateFrom.invoke(),this.front.invoke(),this.side.invoke(),this.unitSide.invoke(),this.unitFront.invoke(),this.unitUp.invoke(),this.assignUpFrame.invoke(),this.assignSideFrame.invoke(),this.assignFrontFrame.invoke(),this.assignTranslation.invoke(),this.look.invoke()}}class ht{constructor(){this.look=new et.cached.subtract({of:rt.FROM,with:rt.TO}),this.delta=new et.cached.multiply({of:this.look.result,with:rt.ZOOM_DELTA}),this.zoomInTo=new et.cached.subtract({of:rt.TO,with:this.delta.result,result:rt.TO}),this.zoomInFrom=new et.cached.subtract({of:rt.FROM,with:this.delta.result,result:rt.FROM}),this.zoomOutTo=new et.cached.add({of:rt.TO,with:this.delta.result,result:rt.TO}),this.zoomOutFrom=new et.cached.add({of:rt.FROM,with:this.delta.result,result:rt.FROM}),this.invoke=this.invoke.bind(this)}invoke(t){return this.look.invoke(),this.delta.invoke(),t?this.zoomOut():this.zoomIn()}zoomIn(){this.zoomInTo.invoke(),this.zoomInFrom.invoke()}zoomOut(){this.zoomOutTo.invoke(),this.zoomOutFrom.invoke()}}class ut{constructor(){this.reciprocalDepth=1/(rt.FAR-rt.NEAR),this.viewingAngle=Math.PI*rt.VIEWING_ANGLE/180/2,this.sinOfViewingAngle=Math.sin(this.viewingAngle),this.cosOfViewingAngle=Math.cos(this.viewingAngle),this.cotOfViewingAngle=this.cosOfViewingAngle/this.sinOfViewingAngle,this.invoke=this.invoke.bind(this)}invoke(){return rt.PROJECTION_MATRIX.data[0]=this.cotOfViewingAngle/rt.ASPECT_RATIO,rt.PROJECTION_MATRIX.data[5]=this.cotOfViewingAngle,rt.PROJECTION_MATRIX.data[10]=-(rt.FAR+rt.NEAR)*this.reciprocalDepth,rt.PROJECTION_MATRIX.data[11]=-1,rt.PROJECTION_MATRIX.data[14]=-2*rt.NEAR*rt.FAR*this.reciprocalDepth,rt.PROJECTION_MATRIX}}class lt{constructor(){this.pan=(new ot).invoke,this.look=(new at).invoke,this.zoom=(new ht).invoke,this.project=(new ut).invoke}}var ct=new class{constructor(){this.objects=[],this.HUD=document.createElement("canvas"),this.HUD.id="hud",this.CANVAS=document.createElement("canvas"),this.CANVAS.id="main",document.body.prepend(this.CANVAS),this.resize(),this.webgl=new nt(this),this.camera=new lt(this),this.pan=this.pan.bind(this),this.zoom=this.zoom.bind(this),this.plot=this.plot.bind(this),this.render=this.render.bind(this),this.keyup=this.keyup.bind(this),this.resize=this.resize.bind(this),this.keydown=this.keydown.bind(this),this.mouseup=this.mouseup.bind(this),this.mousedown=this.mousedown.bind(this),this.mousemove=this.mousemove.bind(this),this.mouse=new st,this.keyboard=new it(rt.BINDINGS),window.addEventListener("resize",this.resize),window.addEventListener("keyup",this.keyup),window.addEventListener("keydown",this.keydown),window.addEventListener("mouseup",this.mouseup),window.addEventListener("mousedown",this.mousedown),window.addEventListener("mousemove",this.mousemove)}mouseup(){this.mouse.mouseup()}mousedown(t){this.mouse.mousedown(t)}mousemove(t){this.mouse.mousemove(t)}keyup(){this.keyboard.keyup()}keydown(t){const e=this.keyboard.keydown(t);e&&(t.preventDefault(),this[e.name].call(null,...e.args))}resize(){this.CANVAS.width=window.innerWidth,this.CANVAS.height=window.innerHeight,this.HUD.width=.5*window.innerWidth,this.HUD.height=.2*window.innerHeight,rt.ASPECT_RATIO=this.CANVAS.width/this.CANVAS.height}plot({vertices:t,colors:e,sizes:s,mode:i}){this.objects.push({sizeBuffer:this.webgl.createBuffer(s),colorBuffer:this.webgl.createBuffer(e),vertexBuffer:this.webgl.createBuffer(t),drawMode:this.webgl.CONTEXT[i],drawCount:t.shape[0]}),this.render()}render(){this.webgl.CONTEXT.clear(this.webgl.CONTEXT.COLOR_BUFFER_BIT);for(const t of this.objects)this.webgl.attributes.a_Color(t.colorBuffer),this.webgl.attributes.a_PointSize(t.sizeBuffer),this.webgl.attributes.a_Position(t.vertexBuffer),this.webgl.uniforms.u_ViewMatrix(this.camera.look()),this.webgl.uniforms.u_ProjMatrix(this.camera.project()),this.webgl.CONTEXT.drawArrays(t.drawMode,0,t.drawCount)}pan(t){this.camera.pan(t),this.render()}zoom(t){this.camera.zoom(t),this.render()}};const pt={vertices:et.tensor({data:[[0,0,-10],[0,0,10],[0,-10,0],[0,10,0],[-10,0,0],[10,0,0]]}),colors:et.ones({shape:[1e4,3]}),sizes:et.ones({shape:[1e4,1]}),mode:"LINES"};et.tensor({data:[[0,0,0],[0,0,1],[0,0,0],[0,1,0],[0,0,0],[1,0,0],[1,1,1],[1,0,1],[1,1,1],[0,1,1],[1,1,1],[1,1,0],[0,0,1],[0,1,1],[0,1,1],[0,1,0],[0,1,0],[1,1,0],[1,1,0],[1,0,0],[1,0,0],[1,0,1],[1,0,1],[0,0,1]]}),et.ones({shape:[1e4,3]}),et.ones({shape:[1e4,1]}),et.linspace({start:0,stop:2*Math.PI,num:1e4}).multiply({with:"i"}).exp().reshape({shape:[1e4,1]}).view({type:et.Float32}),et.zeros({shape:[1e4,3]}).assign({with:[255,255,255]}),et.ones({shape:[1e4,1]}).multiply({with:1});et.randrange({low:0,high:255,shape:[1e6,2]}).divide({with:255});et.ones({shape:[1e6,1]});window.bb=et,window.myio=a,window.app=ct,window.config=rt;e.default=async function(){app.plot(function(t=100){const e=et.linspace({start:0,stop:2*Math.PI,num:t}).multiply({with:"i"}).exp().reshape({shape:[t,1]}).view({type:et.Float32}).insert({with:-2,entries:[2],axis:[1]}),s=et.linspace({start:0,stop:2*Math.PI,num:t}).multiply({with:"i"}).exp().reshape({shape:[t,1]}).view({type:et.Float32}).insert({with:0,entries:[2],axis:[1]}),i=et.zeros({shape:[e.shape[0]+s.shape[0],3]}).assign({region:["::2"],with:e}).assign({region:["1::2"],with:s});return{vertices:i,colors:et.ones({shape:i.shape}).divide({with:2}),sizes:et.ones({shape:[i.shape[0],1]}).multiply({with:20}),mode:"TRIANGLE_STRIP"}}()),app.plot(pt)}()}]);
//# sourceMappingURL=main.js.map